(window.mutinyWpJsonp=window.mutinyWpJsonp||[]).push([[2],{33:function(e,t,i){"use strict";i.d(t,"a",(function(){return E.a}));var n=i(0),r=i(9),s=i(2),o=i(6);class a{constructor(){this.queue=[],this.logger=new s.a("function-queue")}enqueue(e){this.logger.info("Enqueuing function queue item"),this.queue.push(e)}flushAsync(){setTimeout(()=>this.flush(),0)}flush(){const e=[...this.queue];this.queue=[];for(const t of e)this.logger.info("Flushing function queue item"),Object(r.c)(t)}}class l{constructor(e,t=new a){this.isReady=e,this.queue=t,this.retryFlushInterval=250}enqueue(e){this.queue.enqueue(e),this.flush()}flush(){this.isReady()?this.queue.flush():(clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>{this.flush()},this.retryFlushInterval))}flushAsync(){this.flush()}}const c="[Mutiny]";class d{constructor(e,t,i,n){this.visitorToken=e,this.userDataStore=i,this.config=n,this.logger=new s.a("amplitude-adapter"),this.queue=new l(()=>void 0!==this.getAmplitude())}page(){}identify(){this.queue.enqueue(()=>{const e=this.getAmplitude(),{Identify:t}=window.amplitude,i=(new t).set(c+" visitor_id",this.visitorToken);this.logger.info("Calling `identify`"),e.identify(this.config.exposed_user_data_attributes.reduce((e,t)=>e.set(`${c} ${t}`,this.userDataStore.get(t)),i))})}track(e,t){this.queue.enqueue(()=>{switch(e){case E.a.ExperienceImpression:return this.trackImpression(t);case E.a.QuestionnaireResponse:return this.trackQuestionnaireResponseSubmission(t);case E.a.Event:return this.trackEvent(t);default:return}})}trackEvent(e){switch(e.eventType){case n.l.QuestionnaireFormSubmitted:return this.trackQuestionnaireFormSubmission(e)}}trackImpression({experience:e,impressionType:t,audienceSegment:i}){if(i&&(t===n.u.Personalized||t===n.u.Control)){const r=`${e.name}_${i.name}`,s=this.getAmplitude(),{Identify:o}=window.amplitude;return this.logger.info("Calling `amplitude.identify`"),s.identify((new o).set(`${c} ${r}`,t).set(c+" last experience",r)),this.logger.info("Calling `amplitude.logEvent`"),s.logEvent(c+" Experience Viewed",{audienceSegment:null==i?void 0:i.name,experience:null==e?void 0:e.name,personalized:t===n.u.Personalized})}}trackQuestionnaireResponseSubmission({answers:e,questionnaire:t}){const i=this.getAmplitude(),n=e?e.reduce((e,{key:t,value:i})=>Object.assign(Object.assign({},e),{[t]:i}),{}):{};return this.logger.info("Calling `amplitude.logEvent`"),i.logEvent(c+" Questionnaire Completed",Object.assign(Object.assign({},n),{questionnaire:t.key}))}trackQuestionnaireFormSubmission({metadata:{email:e,questionnaire_key:t}}){const i=this.getAmplitude();return this.logger.info("Calling `amplitude.logEvent`"),i.logEvent(c+" Questionnaire Completed",{email:e,questionnaire:t})}getAmplitude(){if(window.amplitude&&"function"==typeof window.amplitude.getInstance){if("a8750e5a67bafbcd"===this.config.api_key){const e=window.location.pathname.startsWith("/blog");return window.amplitude.getInstance(e?"blog_2.0":"corp_site_2.0")}return window.amplitude.getInstance()}}}var u=i(1),h=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};var p=class{constructor(e,t,i,n,r){this.apiClient=r,this.logger=new s.a("hubspot-adapter")}identify(){return h(this,void 0,void 0,(function*(){this.logger.info("Calling `identify`");const e=yield Object(u.h)("hubspotutk");if(e)return this.apiClient.trackVisitorIdentification({identificationType:n.A.Hubspot,value:e})}))}page(){}track(e,t){}},m=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};var g=class{constructor(e,t,i,n,r){this.apiClient=r,this.logger=new s.a("marketo-adapter")}identify(){return m(this,void 0,void 0,(function*(){this.logger.info("Calling `identify`");const e=yield Object(u.h)("_mkto_trk");if(e)return this.apiClient.trackVisitorIdentification({identificationType:n.A.Marketo,value:e})}))}page(){}track(e,t){}},f=i(59);var v=class{constructor(e,t,i,n,r,s,o){this.sessionToken=t,this.store=i,this.config=n,this.apiClient=r,this.clientDataMetadata=o}identify(){}page(){return this.apiClient.trackImpression(this.sessionToken,{client_data_metadata:this.clientDataMetadata,client_iteration:this.config.client_iteration,client_published_at:this.config.published_at,user_data_failed:Boolean(this.store.get(f.a)),user_data_generated_at:this.store.get("generated_at"),user_data_ip_address:this.store.get("user.ip_address"),user_data_metadata:this.store.get("metadata"),user_data_visitor_token:this.store.get("user.token")})}track(e,t){switch(e){case E.a.QuestionnaireResponse:return this.apiClient.trackQuestionnaireResponse(t);case E.a.Conversion:return this.apiClient.trackConversion(t);case E.a.Event:return this.apiClient.trackEvent(t);case E.a.ExperienceImpression:{const e=t;return this.apiClient.trackExperienceImpression(Object.assign(Object.assign({},e),{selfOptimizingEventId:this.store.get(`web_experience_variation.${e.experience&&e.experience.id}.event_id`)}))}case E.a.Time:return this.apiClient.trackTime(t);case E.a.Metric:return this.apiClient.trackMetric(t)}}},b=i(41);class y{constructor(e,t,i,n,r){this.visitorToken=e,this.config=n,this.apiClient=r,this.logger=new s.a("segment-adapter"),this.queue=new l(()=>{var e;return Boolean(null===(e=window.analytics)||void 0===e?void 0:e.ready)})}identify(){this.queue.enqueue(()=>{window.analytics.ready(()=>{if(this.checkAnalyticsValid()){const e=window.analytics.user().id(),t=window.analytics.user().anonymousId();this.logger.info("Calling `segment.identify`"),window.analytics.identify({mutinyVisitorId:this.visitorToken}),this.apiClient.segmentIdentify(e,t)}})})}page(){}track(e,t){this.config.write_to_segment&&this.queue.enqueue(()=>{switch(e){case E.a.ExperienceImpression:return this.trackImpression(t);case E.a.QuestionnaireResponse:return this.trackQuestionnaireResponseSubmission(t);case E.a.Event:return this.trackEvent(t);default:return}})}trackEvent(e){switch(e.eventType){case n.l.QuestionnaireFormSubmitted:return this.trackQuestionnaireFormSubmission(e)}}trackImpression({impressionType:e,audienceSegment:t,experience:i}){this.apiClient.trackMetric({metricKey:"client.segment_track_impression.requested",metricType:n.p.Increment}),(t&&e===n.u.Personalized||e===n.u.Control)&&(this.apiClient.trackMetric({metricKey:"client.segment_track_impression.initiated",metricType:n.p.Increment}),window.analytics.ready(()=>{var r;this.apiClient.trackMetric({metricKey:"client.segment_track_impression.ready",metricType:n.p.Increment}),this.checkAnalyticsValid()&&t&&(this.logger.info("Calling `segment.track`"),window.analytics.track("Mutiny Experience Viewed",{audienceSegment:t.name,experience:i&&(i.name||Object(b.b)(t.id,i.id)),personalized:e===n.u.Personalized,variation:e===n.u.Personalized?null!==(r=null==i?void 0:i.variation_name)&&void 0!==r?r:"":n.u.Control}),this.apiClient.trackMetric({metricKey:"client.segment_track_impression.finished",metricType:n.p.Increment}))}))}trackQuestionnaireResponseSubmission({answers:e,questionnaire:t}){const i=e?e.reduce((e,{key:t,value:i})=>Object.assign(Object.assign({},e),{[t]:i}),{}):{};window.analytics.ready(()=>{this.checkAnalyticsValid()&&(this.logger.info("Calling `segment.track`"),window.analytics.track("Mutiny Questionnaire Completed",Object.assign(Object.assign({},i),{questionnaire:t.key})))})}trackQuestionnaireFormSubmission({metadata:{email:e,questionnaire_key:t}}){window.analytics.ready(()=>{this.checkAnalyticsValid()&&(this.logger.info("Calling `segment.track`"),window.analytics.track("Mutiny Questionnaire Completed",{email:e,questionnaire:t}))})}checkAnalyticsValid(){var e,t,i;return(null===(e=window.analytics)||void 0===e?void 0:e.user)?(null===(t=window.analytics)||void 0===t?void 0:t.identify)&&!!(null===(i=window.analytics)||void 0===i?void 0:i.track)||(this.apiClient.trackMetric({description:`No identify function (${this.config.company_slug}, ${this.visitorToken})`,metricKey:"Unexpected window.analytics object for Segment",metricType:n.p.Event}),!1):(this.apiClient.trackMetric({description:`No user function (${this.config.company_slug}, ${this.visitorToken})`,metricKey:"Unexpected window.analytics object for Segment",metricType:n.p.Event}),!1)}}var w=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};var k=class{constructor(e,t,i,n,r,s){this.visitorToken=e,this.userDataStore=i,this.clientMode=s}identify(){const e={visitorToken:this.visitorToken};window.mutinyData=e;const t=this.userDataStore.toJSON(),{user:i}=t,n=w(t,["user"]);window.mutiny.visitor={data:n,token:this.visitorToken},window.mutiny.experiences=[],window.mutiny.clientMode=this.clientMode}page(){window.mutiny.experiences=[]}track(e,t){switch(e){case E.a.ExperienceImpression:{const{impressionType:e,audienceSegment:i,experience:r}=t;if(i){const t={audienceSegment:null==i?void 0:i.name,experienceName:null==r?void 0:r.name,impressionType:e,personalized:e===n.u.Personalized,visitorToken:this.visitorToken};if(window.mutinyData=t,r){window.mutiny.experiences||(window.mutiny.experiences=[]);const t={audienceSegment:null==i?void 0:i.name,experience:null==r?void 0:r.name,impressionType:e,page:window.location.origin+window.location.pathname,variationKey:null==r?void 0:r.variation_key,variationName:null==r?void 0:r.variation_name};window.mutiny.experiences.push(t),window.dispatchEvent(new CustomEvent(n.i.WindowExperienceImpression,{detail:t}))}}return}default:return}}},_=i(3);var T=class{constructor(e,t,i,n,r){this.apiClient=r}identify(){if(Object(_.i)(window.location.search).mtl)return this.apiClient.trackVisitorIdentification({identificationType:n.A.OneShotUrl,value:window.location.href})}page(){}track(e,t){}};var O=class{constructor(){this.logger=new s.a("google-analytics-adapter"),this.queue=new l(()=>Boolean(window.ga&&window.ga.getAll&&window.ga.getAll().length>0))}identify(){}page(){}getEventLabelForPersonlization(e){return(null==e?void 0:e.variation_name)?`${n.u.Personalized} | ${e.variation_name}`:n.u.Personalized}getEventAction(e,t){return t?t.name?`${e.name} | ${t.name}`:`${e.name} | ${Object(b.b)(e.id,t.id)}`:e.name}track(e,t){this.queue.enqueue(()=>{window.ga(()=>{switch(e){case E.a.ExperienceImpression:{const e=t,i=e.audienceSegment,r=e.experience;if(i){this.logger.info("Calling `ga.send`");const t=e.impressionType===n.u.Personalized?this.getEventLabelForPersonlization(r):e.impressionType;for(const e of window.ga.getAll())e.send({eventAction:this.getEventAction(i,r),eventCategory:"mutinyExperienceQualify",eventLabel:t,hitType:"event",nonInteraction:!0})}break}}})})}},E=i(12);var C=class{constructor(e,t,i,n,r){this.apiClient=r,this.logger=new s.a("google-analytics-4-adapter"),this.queue=new l(()=>Boolean(window.gtag))}identify(){}page(){}track(e,t){this.queue.enqueue(()=>{switch(e){case E.a.ExperienceImpression:{const e=t,i=e.audienceSegment,r=e.experience;i&&r?(this.logger.info("Calling gtag with mutinyExperienceQualify event"),window.gtag("event","mutiny_experience_impression",{experience_id:r.id,experience_name:r.name,experience_type:Object(E.b)(r.experience_type),segment_name:i.name,personalized:e.impressionType===n.u.Personalized,variation_name:r.variation_name,variation_key:r.variation_key}),this.apiClient.trackMetric({metricKey:"client.ga4_adapter.track.success",metricType:n.p.Increment})):this.apiClient.trackMetric({metricKey:"client.ga4_adapter.track.failed",metricType:n.p.Increment});break}}})}};var I=class{constructor(e,t,i,n,r){this.apiClient=r,this.logger=new s.a("google-tag-manager-adapter"),this.queue=new l(()=>Boolean(window.dataLayer))}identify(){}page(){}track(e,t){this.queue.enqueue(()=>{switch(e){case E.a.ExperienceImpression:{const e=t,i=e.audienceSegment,r=e.experience;i&&r?(this.logger.info("Calling GTM with mutiny_experience_impression event"),window.dataLayer.push({event:"mutiny_experience_impression",experience_id:r.id,experience_name:r.name,experience_type:Object(E.b)(r.experience_type),segment_name:i.name,personalized:e.impressionType===n.u.Personalized,variation_name:r.variation_name,variation_key:r.variation_key}),this.apiClient.trackMetric({metricKey:"client.gtm_adapter.track.success",metricType:n.p.Increment})):this.apiClient.trackMetric({metricKey:"client.gtm_adapter.track.failed",metricType:n.p.Increment});break}}})}};const S=[n.n.Mutiny,n.n.Window,n.n.OneShotUrl];t.b=class{constructor(e,t,i,n,r,a,l,c,d){this.apiClient=e,this.trackingDisabled=a,this.preview=l,this.clientMode=c,this.clientDataMetadata=d,this.logger=new s.a("data-exporter");const u=Object(o.d)(r.integrations.concat(S));this.adapters=u.map(e=>{const s=this.getAdapter(e);return this.logger.debug(`Configuring ${e} adapter`),new s(t,i,n,r,this.apiClient,this.clientMode,this.clientDataMetadata)})}identify(){if(this.trackingDisabled)this.preview?this.apiClient.trackPreview():this.logger.info("Skipping `identify` for doNotTrack mode");else{this.logger.info("Calling `identify`");for(const e of this.adapters)e.identify()}}page(){if(this.trackingDisabled)this.logger.info("Skipping `page` for doNotTrack mode");else{this.logger.info("Calling `page`");for(const e of this.adapters)e.page()}}track(e,t){return this.trackingDisabled?(this.logger.info("Skipping `track` for doNotTrack mode"),Promise.resolve()):(this.logger.info("Calling `track`",e,t),Promise.all(this.adapters.map(i=>Promise.resolve(i.track(e,t)))))}forceFlushQueues(){return Object(r.c)(()=>{var e;this.logger.info("Flushing API client queue");const t=this.apiClient.flush(!0);this.logger.info("Flushing all adapters",this.adapters);for(const t of this.adapters)null===(e=t.queue)||void 0===e||e.flush();return t})}disableTracking(){this.trackingDisabled=!0,this.apiClient.disableTracking()}getAdapter(e){switch(e){case n.n.Mutiny:return v;case n.n.Segment:return y;case n.n.Window:return k;case n.n.Amplitude:return d;case n.n.GoogleAnalytics:return O;case n.n.GoogleAnalytics4:return C;case n.n.GoogleTagManager:return I;case n.n.Marketo:return g;case n.n.Hubspot:return p;case n.n.OneShotUrl:return T;default:throw new Error("Unknown integration type "+e)}}}},35:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return m})),i.d(t,"d",(function(){return g})),i.d(t,"c",(function(){return f})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return b})),i.d(t,"g",(function(){return w}));var n=i(19),r=i.n(n),s=i(50),o=i(6),a=i(10),l=i(43),c=i(0),d=i(15),u=i(11),h=i(60);i.d(t,"i",(function(){return d.b})),i.d(t,"h",(function(){return d.a}));const p="_mcm",m="mutiny_experience_override",g="mutiny_variation_override",f="mutiny_highlight",v="personalize.override",b="user.personalize_weight";var y;!function(e){e.Impression="impression",e.QuestionnaireImpression="questionnaireImpression"}(y||(y={}));class w{constructor(e,t){this.events=t;const i={device_type:Object(s.a)(),referrer:document.referrer,user_agent:navigator.userAgent};this.data=r()({browser:i},e),this.listeners=[]}getWriteableStore(){return new k(this.data,this.listeners,this.events)}get(e){const t=Object(a.c)(this.data,e);return null===t?Object(h.a)().getItem(e)||Object(u.a)().getItem(e):t}onChange(e){this.listeners.push(e)}merge(e){return this.data=r()(this.data,e),this}toJSON(){return JSON.parse(JSON.stringify(this.data))}}class k extends w{constructor(e,t=[],i=new l.a){super(e,i),this.events=i,this.listeners=t,this.events.on(c.i.ImpressionCacheUpdate,({detail:e})=>{e.impression&&this.updateImpressionCache(e.impression,y.Impression),e.questionnaireImpression&&this.updateImpressionCache(e.questionnaireImpression,y.QuestionnaireImpression),e.sessionNumber&&this.setBulk({person:{behavior:{session_number:e.sessionNumber}}})})}setBulk(e){const t=r()(Object(a.c)(this.data,"person.behavior")||{},Object(a.c)(e,"person.behavior")||{},{arrayMerge:this.behavioralArrayMerge});this.data=r()(r()(this.data,e),{person:{behavior:t}},{arrayMerge:(e,t)=>t})}getData(){return this.data}set(e,t,{localStorage:i=!0}={}){const n=e.split("."),r=Object.assign({},this.data);return n.reduce((e,i,r)=>(r===n.length-1?e[i]=t:void 0===e[i]&&(e[i]={}),e[i]),r),this.data=r,i&&Object(u.a)().setItem(e,t),this.triggerListeners(e,t),this}getSessionToken(){const e=this.get("query."+d.a);return(null==e?void 0:e.length)?e:d.c.instance.getSessionToken()}isNewUser(){return d.c.instance.getIsNewVisitor()}getUserToken(){const e=this.get("query."+d.b);return(null==e?void 0:e.length)?e:d.c.instance.getVisitorToken()}getClientMode(){var e;switch(null===(e=this.get("query."+p))||void 0===e?void 0:e.toLowerCase()){case c.c.AssetViewer:return c.c.AssetViewer;default:return c.c.Default}}behavioralArrayMerge(e,t){const i=[],n=[];for(const e of t)e.token&&e.token.length>0?i.push(e):n.push(e);for(const t of e)t.token&&t.token.length>0?i.push(t):n.push(t);return[...n,...Object(o.e)(i,e=>e.token)]}triggerListeners(e,t){for(const i of this.listeners)i(e,t)}updateImpressionCache(e,t){const[i,n]=this.impressionCacheAttributeKey(t),r=this.get(i)||[],s=[e,...Array.isArray(r)?r:[]].reduce((e,t)=>(e[t.token]?e[t.token]=Object.assign(Object.assign({},e[t.token]),t):e[t.token]=t,e),{}),o=Object(a.e)(s);this.setBulk({person:{behavior:{[n]:o}}})}impressionCacheAttributeKey(e){switch(e){case y.Impression:return["person.behavior.visited_url","visited_url"];case y.QuestionnaireImpression:return["person.behavior.viewed_questionnaires","viewed_questionnaires"]}}}},39:function(e,t,i){"use strict";var n=i(46);t.a=new class{constructor(){this.elementRegistry=new WeakMap,this.elementAdditionRegistry=new Map,this.registeredPersonalizations=new Set}getPersonalizationForElement(e){return this.elementRegistry.get(e)}getAdditionForElement(e){return this.elementAdditionRegistry.get(e)}getContainingPersonalizationForElement(e){var t;let i=e,n=0;for(;i!==document.body;){if(n++,n>1e3)return null;const e=null!==(t=i instanceof HTMLElement&&this.elementRegistry.get(i))&&void 0!==t?t:void 0;if(e)return e;if(!i.parentElement)return null;i=i.parentElement}return null}getPersonaizationForNode(e){return this.getPersonalizationForNode(e)}getPersonalizationForNode(e){let t=e,i=0;for(;t!==document.body;){if(i++,i>1e3)return null;if(t instanceof Element&&Object(n.d)(t)&&this.registeredPersonalizations.has(t))return t;if(!t.parentElement)return null;t=t.parentElement}return null}getOriginalElement(e){var t;const i=this.getPersonalizationForNode(e);if(i)return null===(t=i.element)||void 0===t?void 0:t.cloneToOriginal.get(e)}getClonedElement(e){var t;const i=this.getContainingPersonalizationForElement(e);if(i)return null===(t=i.element)||void 0===t?void 0:t.originalToClone.get(e)}getPersonalizations(){return Array.from(this.registeredPersonalizations.values())}registerPersonalization(e,t){e&&this.elementRegistry.set(e,t),this.registeredPersonalizations.add(t)}registerAdditionPersonalization(e){const{record:t}=e;t&&this.elementAdditionRegistry.set(t.resource_id,e),this.registeredPersonalizations.add(e)}unregisterPersonalization(e){var t,i;if("addition"!==(null===(t=e.record)||void 0===t?void 0:t.personalization_type)){const t=e;t.originalElement&&this.elementRegistry.get(t.originalElement)===e&&this.elementRegistry.delete(t.originalElement)}"addition"===(null===(i=e.record)||void 0===i?void 0:i.personalization_type)&&this.elementAdditionRegistry.delete(e.record.resource_id),this.registeredPersonalizations.delete(e)}}},41:function(e,t,i){"use strict";i.d(t,"d",(function(){return l})),i.d(t,"c",(function(){return d})),i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var n=i(55),r=i(18),s=i(0),o=i(62),a=i(9);function l(e){return e.audience_segments.some(e=>e.web_experiences.some(e=>Boolean(e.async)))}function c(e){return e.condition_tree?function e(t){if(!t)return!1;if(Object(o.d)(t)){return t.attribute===n.a&&Object(o.a)(s.c.AssetViewer,t.value,t.comparator)}return Object(o.c)(t)?Boolean(t.clauses.some(t=>e(t))):(a.b.notify("Cannot calculate isAssetViewerConditionTree for a condition",{metaData:{condition:JSON.stringify(t)}}),!1)}(e.condition_tree.root_node):function e(t){var i,o;return!!t&&(!(t.attribute!==n.a||!Object(r.a)(s.c.AssetViewer,t.value,t.comparator))||Boolean((null===(i=t.or)||void 0===i?void 0:i.some(t=>e(t)))||(null===(o=t.and)||void 0===o?void 0:o.some(t=>e(t)))))}(e.condition)}function d(e){return e.audience_segments.some(e=>c(e)&&e.web_experiences.length>0)}function u(e,t){return t===s.c.AssetViewer?c(e.audienceSegment):!c(e.audienceSegment)}function h(e,t){return`https://app.mutinyhq.com/segments/${e}/experiences/${t}/edit`}},43:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(2);class r{constructor(){this.logger=new n.a("event-bus")}on(e,t){document.addEventListener(e,t)}off(e,t){document.removeEventListener(e,t)}trigger(e,t={}){this.logger.info(`Dispatching '${e}' event`),document.dispatchEvent(new CustomEvent(e,{detail:t}))}}},44:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return s}));const n=(e,t=50,i)=>{let n=null,r=null;const s=void 0===(null==i?void 0:i.trailing)||(null==i?void 0:i.trailing);return(...i)=>{const o=Date.now();n||(r=o,e(...i));const a=t-(o-(r||0));a<=0||a>t?(n&&(window.clearTimeout(n),n=null),r=o,e(...i)):s&&(n=window.setTimeout(()=>e(...i),a))}},r=(e,...t)=>(...i)=>{const n=[...t,...i];return e(...n)},s=(e,t,i=1e3)=>{for(let n=0;n<i;n++){if(!e())return null;t()}}},46:function(e,t,i){"use strict";i.d(t,"d",(function(){return A})),i.d(t,"e",(function(){return q})),i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return U})),i.d(t,"c",(function(){return B}));var n=i(9),r=i(5),s=i(13),o=i(2);var a=new class{constructor(){this.hasRunMapping={},this.customJavascriptStore={},this.logger=new o.a("custom-js-service")}getCustomJavascriptWrapperName(e){var t;return`mutinyJS${e.resource_id.replaceAll("-","")}${e.custom_javascript?null===(t=e.custom_javascript)||void 0===t?void 0:t.id.replaceAll("-",""):""}`}attachCustomJavascript(e,t,i){var n;const o=Object(r.a)("script");o.nonce=Object(s.a)(),o.setAttribute("type","text/javascript"),o.setAttribute("id",e+"_script");const a=`function ${e}(element, hasRunBefore) { ${i} }`;o.innerHTML=a,document.head.append(o),null===(n=this.logger)||void 0===n||n.info("Attaching custom javascript to element:",t,o),this.customJavascriptStore[e]=window[e]}runCustomJavascript(e,t,i,n){var r,s,o,a;if(t.custom_javascript){const l=this.getCustomJavascriptWrapperName(t);let c=this.customJavascriptStore[l];const d=Boolean(c);c||(this.hasRunMapping[t.custom_javascript.id]=!1,this.attachCustomJavascript(l,e,t.custom_javascript.custom_javascript_string),c=this.customJavascriptStore[l]);try{null===(r=this.logger)||void 0===r||r.info("Running custom javascript with element:",e,c),c(e,this.hasRunMapping[t.custom_javascript.id]),this.hasRunMapping[t.custom_javascript.id]=!0,null==n||n(t.custom_javascript.id,d)}catch(r){this.hasRunMapping[t.custom_javascript.id]=!0,this.logger.warn("Error in custom javascript with element",e,c);const l=r,u=null!==(a=null===(o=null===(s=null==l?void 0:l.message)||void 0===s?void 0:s.toString)||void 0===o?void 0:o.call(s))&&void 0!==a?a:"Error thrown in element-level js";null==n||n(t.custom_javascript.id,d,u),i(t.custom_javascript.custom_javascript_string,u,l)}}}},l=i(0);const c=(e,t)=>{const i=(r=t,A(n=e)?null===(s=n.interactiveClone)||void 0===s?void 0:s.getOriginalOfClonedElement(r):void 0);var n,r,s;const o=i||t;return o.parentElement?R(o.parentElement).indexOf(o):-1};var d=i(17);const u=new Set(["animate","animateMotion","animateTransform","circle","clippath","color-profile","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","hatch","hatchpath","image","line","linearGradient","marker","mask","mesh","meshgradient","meshpatch","meshrow","metadata","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","solidcolor","stop","svg","switch","symbol","text","textPath","title","tspan","unknown","use","view"]),h={html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};class p{constructor(e){this.userData=e,this.renderedNodes=new WeakSet,this.logger=new o.a("node-renderer")}renderNode(e){let t;if("fragment"===e.tag)t=document.createDocumentFragment();else if(u.has(e.tag)){t=document.createElementNS("http://www.w3.org/2000/svg",e.tag);for(const i of Object.keys(e.html_attributes))if("xmlns"!==i){const n=i.split(":")[0];if(n)t.setAttributeNS(h[n],i,Object(d.c)(e.html_attributes[i],this.userData));else{const n=this.buildAttrNode(i,Object(d.c)(e.html_attributes[i],this.userData));n&&t.setAttributeNode(n)}}}else{t=Object(r.a)(e.tag),t.dataset.mutiny="true";for(const i of Object.keys(e.html_attributes))try{const n=this.buildAttrNode(i,Object(d.c)(e.html_attributes[i],this.userData));if(!n)throw new Error(`Could not build attribute node for attribute "${i}"`);t.setAttributeNode(n)}catch(e){this.logger.error("Failed to set HTML attribute",e)}}for(const i of e.inner_html)if("string"==typeof i){const e=document.createTextNode(Object(d.c)(i,this.userData));this.renderedNodes.add(e),t.append(e)}else{const e=this.renderNode(i);t.append(e)}return this.renderedNodes.add(t),t}buildAttrNode(e,t){var i,n;const r=null===(i=(new DOMParser).parseFromString(`<div id="tmp" ${e} />`,"text/html").querySelector("#tmp"))||void 0===i?void 0:i.getAttributeNode(e);return t&&r&&(r.value=t),null!==(n=null==r?void 0:r.cloneNode(!0))&&void 0!==n?n:null}}const m=e=>{if(!(e instanceof HTMLElement))return e;e.dataset.mutiny="true";for(const t of Array.from(e.children))m(t);return e};var g=(e,t,i)=>{const n=new p(i),r="string"==typeof t.content?(e=>{const t=(new DOMParser).parseFromString(e,"text/html");if(1===t.body.childNodes.length)return m(t.body.childNodes[0]);const i=document.createDocumentFragment();return i.append(...Array.from(t.body.childNodes).map(e=>m(e))),i})(Object(d.c)(t.content,i)):n.renderNode(t.content);return e.innerHTML="",e.append(r),n.renderedNodes},f=i(68),v=i(51),b=i(23);function y(e){const t=new b.a,i=t.insertRule(`tmp { ${e} }`),n=t.cssRules[null!=i?i:0];return function(e){return e.type===CSSRule.STYLE_RULE}(n)?n:void 0}function w(e,t){var i,n,r;const s=y(null!==(i=t.getAttribute("style"))&&void 0!==i?i:""),o=y(e),a=new Set(Array.from(null!==(n=null==o?void 0:o.style)&&void 0!==n?n:[])),l=Array.from(null!==(r=null==s?void 0:s.style)&&void 0!==r?r:[]).filter(e=>!a.has(e));for(const e of l)t.style.removeProperty(e);if(o)for(const e of Array.from(o.style))t.style.setProperty(e,o.style.getPropertyValue(e),o.style.getPropertyPriority(e))}var k=i(39);function _(e){return[HTMLInputElement,HTMLSelectElement,HTMLOptionElement].some(t=>e instanceof t)}function T(e){return e instanceof HTMLAnchorElement}class O{constructor(e,t,i){var n;this.styleSheet=new b.a,this.cloneToOriginal=new WeakMap,this.originalToClone=new WeakMap,this.mutationListeners=[],this.cloneToOriginalNodes=new WeakMap,this.originalToCloneNodes=new WeakMap,this.options=Object.assign({cloneMutations:!0},i),this.originalElement=e,this.personalization=t,this.logger=new o.a("InteractiveClone:"+(null===(n=t.record)||void 0===n?void 0:n.resource_id))}initialize(){this.clone(this.originalElement),this.updateElementMapping(),this.mutationObserver=new MutationObserver(e=>{for(const t of e)switch(t.type){case"attributes":this.handleAttributeMutation(t);break;case"characterData":this.handleCharacterDataMutation(t);break;case"childList":this.handleChildListMutation(t)}for(const t of this.mutationListeners)t(this.personalization,this.originalElement,e);return!0}),this.mutationObserver.observe(this.originalElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0})}teardown(){var e;null===(e=this.mutationObserver)||void 0===e||e.disconnect()}addMutationListener(e){this.mutationListeners.push(e)}removeNestedPersonalization(e){const t=this.cloneToOriginal.get(e);if(!t)return;this.cloneToOriginal.delete(e);const i=this.clone(t);i&&(this.originalToClone.set(t,i),this.cloneToOriginal.set(i,t))}handleChildListMutation(e){var t;if(!this.options.cloneMutations)return;for(const i of Array.from(e.removedNodes)){if(i instanceof HTMLElement?!this.originalToClone.has(i):!this.originalToCloneNodes.has(i))continue;const e=i instanceof HTMLElement?this.originalToClone.get(i):this.originalToCloneNodes.get(i);null===(t=null==e?void 0:e.parentNode)||void 0===t||t.removeChild(e)}const i=this.originalToClone.get(e.target),n=null===e.nextSibling?null:e.nextSibling instanceof HTMLElement?this.originalToClone.get(e.nextSibling):this.originalToCloneNodes.get(e.nextSibling);for(const t of Array.from(e.addedNodes)){if(k.a.getContainingPersonalizationForElement(t)!==this.personalization)continue;const e=t instanceof HTMLElement&&A(t),r=e?t:t.cloneNode(!0);if(e){if(e&&!q(t)){const e=t.originalElement;if(!e)continue;const n=this.originalToClone.get(e);if(!n)continue;this.logger.debug("Detected a personalization being added to the original tree. Replacing:",n,"with personalization:",t),null==i||i.replaceChild(t,n),this.updateElementMapping(e,t)}}else null==i||i.insertBefore(r,null!=n?n:null),this.updateElementMapping(t,r)}}handleAttributeMutation(e){if(!(e.target instanceof HTMLElement&&e.attributeName))return;if(e.target===this.originalElement)return this.cloneAttribute(e.attributeName,this.originalElement,this.personalization),void this.personalization.attributeChangeCallback(e.attributeName,e.oldValue,this.personalization.getAttribute(e.attributeName));if(!this.options.cloneMutations)return;const t=this.originalToClone.get(e.target);if(t){if(A(t))return;this.cloneAttribute(e.attributeName,e.target,t)}}handleCharacterDataMutation(e){var t;if(!this.options.cloneMutations)return;const i=this.originalToCloneNodes.get(e.target);if(!i)return;const n=e.target.cloneNode(!0);null===(t=i.parentNode)||void 0===t||t.replaceChild(n,i),this.updateElementMapping(e.target,n)}clone(e){var t;if(e===this.originalElement){for(const e of this.originalElement.getAttributeNames())this.cloneAttribute(e,this.originalElement,this.personalization),this.personalization.attributeChangeCallback(e,null,this.originalElement.getAttribute(e));const e=[];for(const t of Array.from(this.originalElement.childNodes))e.push(t.cloneNode(!0));return this.personalization.innerHTML="",void this.personalization.append(...e)}const i=this.originalToClone.get(e);if(!i)return;const n=e.cloneNode(!0);return null===(t=i.parentElement)||void 0===t||t.replaceChild(n,i),n}updateElementMapping(e,t){var i;e||t||(this.cloneToOriginal=new WeakMap,this.originalToClone=new WeakMap,this.cloneToOriginalNodes=new WeakMap,this.originalToCloneNodes=new WeakMap);const n=new Set,r=[],s=new Set;let o=!0;this.traverseTreeWith((e,t)=>{var i;q(e)&&s.add(e);const a=k.a.getPersonalizationForElement(e);return a&&a!==this.personalization?(t!==a&&(r.push({replace:t,withElement:a}),q(a)&&s.add(a)),q(a)||(this.cloneToOriginal.set(a,e),this.originalToClone.set(e,a)),"break"):A(t)&&t!==this.personalization&&!(null===(i=t.isRendered)||void 0===i?void 0:i.call(t))?(n.add(t),"break"):(t.dataset.mutiny="true",this.elementMatches(e,t)||(o=!1),o&&(this.cloneToOriginal.set(t,e),this.originalToClone.set(e,t)),"continue")},e,t);for(const e of n)e.remove();for(const{replace:e,withElement:t}of r)null===(i=e.parentElement)||void 0===i||i.replaceChild(t,e);for(const e of s)e.placePersonalization();o||e||t||(this.cloneToOriginal=new WeakMap,this.originalToClone=new WeakMap,this.cloneToOriginalNodes=new WeakMap,this.originalToCloneNodes=new WeakMap)}traverseTreeWith(e,t,i){const n=(t,i)=>{var r,s,o,a;if(t instanceof HTMLElement||i instanceof HTMLElement||(this.originalToCloneNodes.set(t,i),this.cloneToOriginalNodes.set(i,t)),!(t instanceof HTMLElement&&i instanceof HTMLElement&&"break"===e(t,i)))for(let e=0;e<i.childNodes.length;e++){const l=null===(s=null===(r=null==t?void 0:t.childNodes)||void 0===r?void 0:r.item)||void 0===s?void 0:s.call(r,e),c=null===(a=null===(o=null==i?void 0:i.childNodes)||void 0===o?void 0:o.item)||void 0===a?void 0:a.call(o,e);l&&c&&n(l,c)}};n(null!=t?t:this.originalElement,null!=i?i:this.personalization)}elementMatches(e,t){return["tagName","id"].every(i=>e[i]===t[i])&&e.children.length===t.children.length}getOriginalOfClonedElement(e){return this.cloneToOriginal.get(e)}cloneAttribute(e,t,i){var n;if("style"===e)return void w(null!==(n=t.getAttribute("style"))&&void 0!==n?n:"",i);const r=t.getAttributeNode(e);r?i.setAttributeNode(r.cloneNode(!0)):i.removeAttribute(e)}}for(const e of Object(v.b)()){const t=["scroll","wheel","mousewheel","touch","drag"].some(t=>e.startsWith(t));window.addEventListener(e,e=>{var i,n;if(!(e.target instanceof HTMLElement))return;const r=k.a.getPersonalizationForNode(e.target);if(!r)return;const s=null===(i=r.element)||void 0===i?void 0:i.cloneToOriginal.get(e.target);if(s){if(!t){let t=e.target,i=0;for(;null!==t&&t!==r&&i++<100&&!T(t);)t=t.parentElement;if(t instanceof HTMLElement&&T(t)){const i=A(t)?t.originalElement:null===(n=r.element)||void 0===n?void 0:n.cloneToOriginal.get(t);if(T(i)){if(t.href!==i.href)return;e.preventDefault()}}}_(s)&&_(e.target)&&e.target.value!==s.value&&(s.value=e.target.value),null==s||s.dispatchEvent(new e.constructor(e.type,e))}},!t||Object.assign(Object.assign({},v.d),{capture:!0}))}var E=i(58),C=i(47),I=i(33);const S="style";var M=(e,t,i,n)=>{var r;const s=new o.a("AttributeApplier:"+t.id);for(const o of Object.keys(t.html_attributes))if("class"!==o||t.replace_classes)(a=o).startsWith("data-mutiny")||[S].includes(a)?(s.warn("Received HTML style attributes in AttributeApplier"),null===(r=null==n?void 0:n.exporter)||void 0===r||r.track(I.a.Metric,{description:`DOM Update ID: ${t.id}; Attribute: ${o}`,metricKey:"Client DOM Update contains blacklisted attribute",metricType:l.p.Event})):e.setAttribute(o,Object(d.c)(t.html_attributes[o],i));else{const n=Object(d.c)(t.html_attributes[o],i).split(/\s+/g).filter(e=>e.length>0);for(const t of n)e.classList.add(t)}var a};var x=(e,t,i)=>{w(Object(d.c)(t.cssText,i),e)},j=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};const N=e=>`mutiny-${e.toLowerCase()}-personalization`,P=new Map,z=new Set,A=e=>{var t,i,n,r;return!!e&&(null!==(n=null!==(t=e.isMutinyElement)&&void 0!==t?t:(r=null!==(i=e.getAttribute("is"))&&void 0!==i?i:"",/^mutiny-[\da-z-]+-personalization$/.test(r)))&&void 0!==n&&n)},q=e=>{var t;return A(e)&&!!(null===(t=e.record)||void 0===t?void 0:t.data.position)},D=new Set(["mutiny-preview-app","mutiny-browser-editor-component","mutiny-preact"]),R=e=>Array.from(e.children).filter(t=>t!==e&&!A(t)&&!(e=>D.has(e.id)||e instanceof HTMLElement&&"radixFocusGuard"in e.dataset)(t)),L=e=>class extends e{constructor(){super(),this.initialized=!1,this.rendered=!1,this.tearingDown=!1,this.logger=new o.a("mutiny-personalization"),this.reattachedCounter=0,this.mutationObserver=new E.a(e=>{var t,i,n,r,s,o,a,c,d;if(!this.isRendered())return!1;if((null===(i=null===(t=this.record)||void 0===t?void 0:t.data)||void 0===i?void 0:i.content)&&(null===(r=null===(n=this.record)||void 0===n?void 0:n.data)||void 0===r?void 0:r.render_only_once))return!1;this.logger.info("Mutations observed",e);const u=e.filter(e=>!Object(C.a)(e));if(this.logger.info("Non mutiny mutations observed",u),0===u.length)return!0;null===(s=this.exporter)||void 0===s||s.apiClient.trackMetric({metricKey:"client.mutation.observed.personalization",metricType:l.p.Increment});const{record:h,userData:p}=this.getContext(),m=!!h.data.content;let f=!1;const v=[];for(const e of u)if("childList"===e.type)for(const t of Array.from(e.addedNodes))"modification"===h.personalization_type&&k.a.getPersonalizationForNode(t)!==this||(m?(null===(o=this.contentChangeNodes)||void 0===o?void 0:o.has(t))||(f=!0):"modification"!==h.personalization_type||(t instanceof HTMLElement?null===(a=this.element)||void 0===a?void 0:a.cloneToOriginal.has(t):null===(c=this.element)||void 0===c?void 0:c.cloneToOriginalNodes.has(t))||(v.push(t),null===(d=t.parentNode)||void 0===d||d.removeChild(t)));return f&&h.data.content&&(this.contentChangeNodes=g(this,{id:h.resource_id,content:h.data.content},p),this.executeCustomJs(),this.logger.info("Clearing mutations from content update:",this.mutationObserver.takeRecords())),this.logger.info("Removed non mutiny nodes",v),!0},{callbackLimit:10,disconnectCallback:()=>{this.teardown()}}),this.mutationObserver.observe(this,{childList:!0,subtree:!0});try{this.root=this.attachShadow({mode:"closed"});const e=Object(r.a)("slot");e.style.setProperty("box-sizing","inherit"),this.root.append(e)}catch(e){this.logger.log("Element type cannot be used as shadow root. Falling back to rendering personalization within the main tree.")}}get isMutinyElement(){return!0}get nodeName(){return window.__MUTINY_DISABLE_PERSONALIZATION_MASKING?super.nodeName:"MUTINY-"+super.nodeName}get nodeType(){return window.__MUTINY_DISABLE_PERSONALIZATION_MASKING?super.nodeType:Node.COMMENT_NODE}initializePersonalization(e,t,i,n,r,s){this.initialized?this.logger.error("Attempted to initialize the same personalization more than once."):(this.logger=new o.a("mutiny-personalization:"+t.resource_id),this.originalElement=e,this.record=t,this.userData=i,this.exporter=r,this.mutinyParentElement=n,this.onCustomJsExecuted=s,this.render(),this.initialized=!0)}isRendered(){return this.rendered&&this.isConnected}render(){var e,t;const{record:i,userData:n}=this.getContext(),{remove:r,content:s}=i.data;if(!this.rendered){if(this.rendered=!0,"addition"===i.personalization_type&&k.a.registerAdditionPersonalization(this),!this.element&&"addition"!==i.personalization_type){if(!this.originalElement)throw new Error("could not retrieve original element");if(k.a.registerPersonalization(this.originalElement,this),r)return void(this.elementHider=new f.c(this.originalElement,i.selector));this.element=new O(this.originalElement,this,{cloneMutations:!s}),this.element.initialize(),"addition"!==(null===(e=this.record)||void 0===e?void 0:e.personalization_type)&&(this.elementHider=new f.c(this.originalElement,i.selector))}s&&(this.contentChangeNodes=g(this,{id:i.resource_id,content:s},n),null===(t=this.element)||void 0===t||t.updateElementMapping()),this.applyAttributePersonalization(),this.executeCustomJs(),this.logger.info("Clearing mutations resulting from render:",this.mutationObserver.takeRecords())}}placePersonalization(){var e,t,i,n;const{record:{data:{position:r},personalization_type:s},originalElement:o}=this.getContext();(null===(e=this.getParentPersonalization())||void 0===e?void 0:e.contains(this))&&(null===(i=null===(t=this.getParentPersonalization())||void 0===t?void 0:t.element)||void 0===i||i.removeNestedPersonalization(this));const a=this.getTargetPositionParent();if(r&&a){const e=((e,t,i,n)=>{var r,s;const o=Array.from(i.children);for(const a of o)if(("modification"!==n||a!==e.originalElement)&&a!==e)if(A(a)&&(null===(r=a.record)||void 0===r?void 0:r.data.position)){const e=a.record.data.position;if(e.index>=t.index&&e.deconflictor>=t.deconflictor)return a}else if(A(a)&&(null===(s=a.originalElement)||void 0===s?void 0:s.parentElement)){if(R(a.originalElement.parentElement).indexOf(a.originalElement)>=t.index)return a}else if(c(i,a)>=t.index)return a;return null})(this,r,a,s);this.logger.debug("Placing personalization:",this,"within:",a,"before:",e),a.insertBefore(this,e)}else this.logger.debug("Placing personalization:",this,"after original element:",o),null===(n=null==o?void 0:o.parentElement)||void 0===n||n.insertBefore(this,o.nextSibling)}teardown(){var e,t,i,n,r;if(!this.rendered)return;this.tearingDown=!0,null===(e=this.element)||void 0===e||e.teardown(),this.rendered=!1,k.a.unregisterPersonalization(this),null===(t=this.elementHider)||void 0===t||t.show();const s=this.getContext().record.data.position&&this.getTargetPositionParent();(null===(i=this.getParentPersonalization())||void 0===i?void 0:i.contains(this))&&!s&&(null===(r=null===(n=this.getParentPersonalization())||void 0===n?void 0:n.element)||void 0===r||r.removeNestedPersonalization(this)),this.remove()}attributeChangeCallback(e,t,i){var n,r,s,o;const{record:a}=this.getContext(),{html_attributes:l,styles:c}=a.data;if("style"===e)for(const e of Object.keys(null!==(r=null===(n=this.elementHider)||void 0===n?void 0:n.originalStyles)&&void 0!==r?r:{}))this.style.setProperty(e,null!==(o=null===(s=this.elementHider)||void 0===s?void 0:s.originalStyles[e])&&void 0!==o?o:"");(Object.keys(null!=l?l:{}).includes(e)||"style"===e&&c)&&this.applyAttributePersonalization()}disconnectedCallback(){requestAnimationFrame(()=>{var e,t;if(!this.isConnected&&!this.isNested())if(!this.initialized||this.tearingDown||"addition"!==(null===(e=this.record)||void 0===e?void 0:e.personalization_type)&&!(null===(t=this.element)||void 0===t?void 0:t.originalElement.isConnected))k.a.unregisterPersonalization(this),this.rendered=!1;else{if(this.reattachedCounter>=100)return this.logger.error("Attempted to reattach more times than the permitted limit.",this),k.a.unregisterPersonalization(this),void(this.rendered=!1);this.logger.warn("Personalization was disconnected premmaturely. Attempting to reattach.",this),this.placePersonalization(),this.reattachedCounter++}})}executeCustomJs(){const{record:e}=this.getContext();a.runCustomJavascript(this,e,(e,t,i)=>{var n,r,s;null===(n=this.exporter)||void 0===n||n.apiClient.trackMetric({description:t,metricKey:"element-level js error",metricType:l.p.Event,tags:{name:null!==(r=null==i?void 0:i.name)&&void 0!==r?r:"",message:t,stack:null!==(s=null==i?void 0:i.stack)&&void 0!==s?s:"",code:e}})},this.onCustomJsExecuted)}getTargetPositionParent(){const e=this.mutinyParentElement&&k.a.getClonedElement(this.mutinyParentElement);return null!=e?e:this.mutinyParentElement}getParentPersonalization(){return this.parentElement?k.a.getPersonalizationForNode(this.parentElement):null}isNested(){var e,t;return null!==(t=null===(e=this.getParentPersonalization())||void 0===e?void 0:e.isRendered())&&void 0!==t&&t}get interactiveClone(){return this.element}get replacedStyleAttribute(){var e,t,i,n;if("addition"===(null===(e=this.record)||void 0===e?void 0:e.personalization_type))return null!==(t=this.getAttribute("style"))&&void 0!==t?t:void 0;if(!this.originalElement)return;if(!this.elementHider)return null!==(i=this.originalElement.getAttribute("style"))&&void 0!==i?i:void 0;const r=this.originalElement.cloneNode(!1);for(const[e,t]of Object.entries(this.elementHider.originalStyles))t&&r.style.setProperty(e,t);return null!==(n=r.getAttribute("style"))&&void 0!==n?n:void 0}applyAttributePersonalization(){const{record:e,userData:t}=this.getContext(),{html_attributes:i,styles:n,replace_classes:r}=e.data,s=i||{},{style:o}=s,a=j(s,["style"]),l=[n?Object.entries(n).map(e=>e.join(": ")).join("; "):"",o].filter(Boolean).join("; ");a&&M(this,{id:e.resource_id,html_attributes:a,replace_classes:r},t,{exporter:this.exporter}),l&&x(this,{id:e.resource_id,cssText:l},t)}getContext(){if(!this.record||!this.userData||"addition"!==this.record.personalization_type&&!this.originalElement)throw this.logger.error("Attempted to call getContext on MutinyPersonalization prior to initializing"),new Error("initializePersonalization must be called prior to interacting with personalizations");return{record:this.record,userData:this.userData,originalElement:this.originalElement}}};L(HTMLElement);function U(e){if(function(e){const t=N(e),i=Object(r.a)(e);if(z.has(t))return!1;if(P.has(t))return!0;const s=Object.getPrototypeOf(i).constructor,o=L(s);try{customElements.define(t,o,{extends:i.tagName.toLowerCase()}),P.set(t,o)}catch(e){return function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.message}(e)&&e.code===DOMException.NOT_SUPPORTED_ERR&&n.b.notify(e),z.add(t),!1}return!0}(e))return N(e)}function B(e){return U(e.tagName)}},47:function(e,t,i){"use strict";function n(e){var t;return e.nodeType===e.COMMENT_NODE||e instanceof HTMLElement&&(!!(null===(t=e.dataset)||void 0===t?void 0:t.mutiny)||e.isMutinyElement)}function r({target:e,addedNodes:t,removedNodes:i,type:r}){const s=e,o=Array.from(t).concat(Array.from(i));return"childList"!==r?n(s):o.length>0&&o.every(e=>e&&n(e))}i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r}))},48:function(e,t,i){"use strict";let n,r;function s(){var e;n=document.cloneNode(!0),r=new WeakMap,function e(t,i){if(null==r||r.set(t,i),i.childNodes.length>0)for(let n=0;n<i.childNodes.length;n++)e(t.childNodes[n],i.childNodes[n])}(n,document);for(const t of Array.from(n.querySelectorAll("mutiny-personalization"))){const i=t.querySelector("mutiny-variation[control]");if(i){const n=document.createDocumentFragment();for(const e of Array.from(i.childNodes))n.append(e);null===(e=t.parentNode)||void 0===e||e.replaceChild(n,t)}else t.remove()}for(const e of Array.from(n.querySelectorAll("[data-mutiny],[data-mutiny-root]")))e.remove()}function o(){n=null}function a(e,t="independent"){if("legacy"===t)return document.querySelectorAll(e);const i=(n||s(),n);return Array.from(i.querySelectorAll(e)).map(e=>null==r?void 0:r.get(e)).filter(e=>!!e)}function l(e,t="independent"){var i,n;return null!==(n=null===(i=a(e,t))||void 0===i?void 0:i[0])&&void 0!==n?n:null}i.d(t,"a",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return l}))},50:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return o}));const n=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,r=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[23]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i;function s(){const e=navigator.userAgent||navigator.vendor;return n.test(e)||r.test(e.slice(0,4))}function o(){return s()?"mobile":"desktop"}},51:function(e,t,i){"use strict";i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"d",(function(){return l}));var n=i(0);function r(e,t,i,n){let r=!1;e.preventDefault();const s=t().then(()=>{r||(r=!0,i(e))}).catch(()=>{r||i(e)});return setTimeout(()=>{r||(r=!0,i(e))},n),s}function s(e){const t=i=>{(function(e){return e instanceof MessageEvent&&e.data&&e.data.type===n.i.AssetViewerOpened})(i)&&(e.exporter.page(),window.removeEventListener("message",t))};window.addEventListener("message",t)}let o;function a(){if(o)return o;const e=new Set(["click","dblclick","keydown","keypress","keyup","scroll"]);for(const t of[HTMLElement,HTMLFormElement,HTMLInputElement,HTMLMediaElement,HTMLVideoElement,HTMLCanvasElement,HTMLSelectElement])for(const i of Object.keys(t.prototype).filter(e=>e.startsWith("on")))e.add(i.slice(2));return o=Array.from(e.values()),o}let l=!1;try{window.addEventListener("test",()=>{},Object.defineProperty({},"passive",{get(){l={passive:!0}}}))}catch(e){}},55:function(e,t,i){"use strict";i.d(t,"b",(function(){return R})),i.d(t,"c",(function(){return L})),i.d(t,"a",(function(){return B})),i.d(t,"d",(function(){return F}));var n=i(22),r=(i(49),i(50)),s=i(2),o=i(0),a=i(3),l=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))};class c extends Error{static unknownError(){return new this(this.UNKNOWN)}static invalidResponse(e){return new this(`${this.INVALID_RESPONSE}: ${e}`)}}c.UNKNOWN="unknown",c.INVALID_RESPONSE="invalid response";var d=class{constructor(e,t,i){this.apiKey=e,this.visitorToken=t,this.timer=i,this.buffer=[],this.batchTrackingUrl=(window.MUTINY_API_URL||"https://api-v2.mutinyhq.io")+"/v2/b",this.logger=new s.a("batch-request-scheduler"),this.resetInterval(),this.timer.callOnPageInactive(()=>this.flush()),window.addEventListener("beforeunload",()=>this.teardown())}track(e,t,i=!1){this.logger.debug("Adding event of to batch request buffer",e,t);const n=new Promise(i=>{this.buffer.push({onComplete:i,payload:t,trackType:e})});return(this.buffer.length>=20||i)&&(this.logger.info("Batch request buffer has exceeded element limit. Flushing"),this.resetInterval(),this.flush()),n}flush(){return l(this,void 0,void 0,(function*(){if(0===this.buffer.length)return;const e=this.clearBuffer();this.logger.debug(`Flushing ${e.length} entries to batch endpoint`,e);const t=this.generateBody(e);try{yield null!==t?this.sendEvents(t):Promise.resolve()}catch(t){return this.buffer.unshift(...e),void this.trackRequestFailed()}for(const{onComplete:t}of e)try{t()}catch(e){}}))}teardown(){this.logger.info("Page unloaded detected. Beginning teardown process"),this.requestInterval&&clearInterval(this.requestInterval),this.flush()}generateBody(e){const t=this.formatEvents(e);return this.logger.info("Events",t),this.logger.info("Visitor Token",this.visitorToken),t.length>0?JSON.stringify({events:t,metadata:{client_version:"4.14.33"},token:this.apiKey,visitor_token:this.visitorToken}):null}formatEvents(e){return e.reduce((e,t)=>{const i=this.formatEvent(t);return null!==i&&e.push(i),e},[])}formatEvent({trackType:e,payload:t}){switch(e){case h.Impression:return{event_type:"impression",payload:t};case h.ExperienceImpression:return{event_type:"experience_impression",payload:t};case h.QuestionnaireImpression:return{event_type:"questionnaire_impression",payload:t};case h.QuestionnaireResponse:return{event_type:"questionnaire_response",payload:t};case h.Conversion:return{event_type:"conversion",payload:t};case h.ImpressionEvent:return{event_type:"event",payload:t};case h.ImpressionTime:return{event_type:"impression_time",payload:t};case h.Preview:return{event_type:"preview",payload:t};case h.Identify:return{event_type:"identify",payload:t};case h.SegmentIdentify:return{event_type:"segment_identify",payload:t};case h.Metric:return{event_type:"metric",payload:t};case h.VisitorIdentification:return{event_type:"visitor_identification",payload:t};default:return this.logger.info("Unrecognized TrackType found. Ignoring event",e,t),null}}resetInterval(){this.requestInterval&&clearInterval(this.requestInterval),this.requestInterval=setInterval(()=>this.flush(),3e3)}clearBuffer(){const e=this.buffer;return this.buffer=[],e}trackRequestFailed(){this.buffer.some(({payload:e})=>"client.tracking_request.failed"===(null==e?void 0:e.metric_key))||this.track(h.Metric,{metric_key:"client.tracking_request.failed",metric_type:o.p.Increment,tags:{client_version:"4.14.33"}})}sendEvents(e){return l(this,void 0,void 0,(function*(){const t=yield window.fetch(this.batchTrackingUrl,{body:e,method:"POST",keepalive:!0});if(!t.ok)throw c.invalidResponse(t.statusText)}))}},u=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};var h;!function(e){e.Identify="identify",e.SegmentIdentify="segment_identify",e.Preview="preview",e.Impression="impression",e.ExperienceImpression="experience_impression",e.Conversion="conversion",e.QuestionnaireImpression="questionnaire_impression",e.QuestionnaireResponse="questionnaire_response",e.ImpressionEvent="impression_event",e.ImpressionTime="impression_time",e.Metric="metric",e.VisitorIdentification="visitor_identification"}(h||(h={}));var p=class{constructor(e,t,i,n){this.apiKey=e,this.companyToken=t,this.visitorToken=i,this.sessionToken=n}getNextAssets(e,t=3,i=[]){return Promise.resolve(fetch(this.buildUrl(),{body:this.buildRequestBody(e,t,i),method:"POST"}).then(e=>e.json()))}buildUrl(){return`${window.MUTINY_USER_DATA_URL||"https://client-registry.mutinycdn.com"}/personalize/${this.companyToken}/assets.json?preview=true`}buildRequestBody(e,t,i){return JSON.stringify({excluded_actions:i,requested_items:t,session_token:this.sessionToken,visitor_token:this.visitorToken,web_experience_id:e})}},m=i(59),g=i(9),f=i(60),v=i(35),b=i(8);const y=["preview","mutiny",v.i,v.h,v.a,v.b,v.d];function w(e,t,i){const n=Object(b.c)(),r=(null==n?void 0:n.variable_overrides)?n.variable_overrides:{},s={person:{behavior:{session_number:i.getAndSetSessionNumber(),viewed_questionnaires:i.impressionStore.questionnaireImpressions,visited_url:i.impressionStore.impressions}}},o=Object(a.i)(window.location.search);return function(e,{campaign_query_param_keys:t}){const i=new Set([...y,...t]),n=Object(f.a)();for(const t of Object.keys(e).filter(e=>!i.has(e)))n.setItem("query."+t,e[t])}(o,e),new v.g(Object.assign(Object.assign(Object.assign({},s),{query:o}),r),t).getWriteableStore()}var k=i(61),_=i(33),T=i(43);var O=class{constructor(){this.listeners=[],this.onChange=e=>{this.logger.info("Attaching change listener"),this.listeners.push(e)},this.logger=new s.a("state-change-handler")}attach(){const e=window.history,{pushState:t,replaceState:i}=e;let n=Object.assign({},window.location);this.logger.debug("Overriding window.history.pushState"),e.pushState=(...i)=>{const r=t.apply(e,i);return this.urlChanged(n)&&(this.logger.info("Calling listeners for window.history.pushState"),this.executeListeners()),n=Object.assign({},window.location),r},e._mutinyPushState=t,this.logger.debug("Overriding window.history.replaceState"),e.replaceState=(...t)=>{const r=i.apply(e,t);return this.urlChanged(n)&&(this.logger.info("Calling listeners for window.history.replaceState"),this.executeListeners()),n=Object.assign({},window.location),r},e._mutinyReplaceState=i,this.logger.debug("Adding popstate event listener"),window.addEventListener("popstate",()=>{this.urlChanged(n)&&(this.logger.info("Calling listeners for window.onpopstate"),this.executeListeners()),n=Object.assign({},window.location)})}executeListeners(){try{for(const e of this.listeners)e()}catch(e){g.b.notify(e)}}urlChanged(e){const{pathname:t,hash:i}=e;return window.location.pathname!==t||window.location.hash!==i}},E=i(44);const C=["scroll","resize"],I=["wheel","keydown","keyup","mousedown","mousemove","touchstart","touchmove","click","contextmenu"];class S{constructor({timeIntervalEllapsedCallbacks:e=[],absoluteTimeEllapsedCallbacks:t=[],checkCallbacksIntervalMs:i=100,browserTabInactiveCallbacks:n=[],idleCallbacks:r=[],stopTimerOnTabchange:s=!0,activeCallbacks:o=[],browserTabActiveCallbacks:a=[],idleTimeoutMs:l=3e3}){this.startTimer=()=>{this.checkCallbackIntervalId||this.checkCallbacksOnInterval();const e=this.times[this.times.length-1];null!==(null==e?void 0:e.stop)&&(this.times.push({start:performance.now(),stop:null}),this.running=!0)},this.stopTimer=()=>{0!==this.times.length&&(this.times[this.times.length-1].stop=performance.now(),this.running=!1)},this.addTimeIntervalEllapsedCallback=e=>{this.timeIntervalEllapsedCallbacks.push(e)},this.addAbsoluteTimeEllapsedCallback=e=>{this.absoluteTimeEllapsedCallbacks.push(e)},this.addBrowserTabInactiveCallback=e=>{this.browserTabInactiveCallbacks.push(e)},this.addBrowserTabActiveCallback=e=>{this.browserTabActiveCallbacks.push(e)},this.addIdleCallback=e=>{this.idleCallbacks.push(e)},this.addActiveCallback=e=>{this.activeCallbacks.push(e)},this.getTimeInMilliseconds=()=>this.times.reduce((e,t)=>e=t.stop?e+(t.stop-t.start):e+(performance.now()-t.start),0),this.isRunning=()=>this.running,this.isIdle=()=>this.idle,this.reset=()=>{this.times=[]},this.destroy=()=>{this.unregisterEventListeners(),this.checkCallbackIntervalId&&window.clearInterval(this.checkCallbackIntervalId)},this.onBrowserTabInactive=()=>{this.isRunning()&&this.stopTimerOnTabchange&&this.stopTimer();for(const e of this.browserTabInactiveCallbacks)e(this.getTimeInMilliseconds())},this.onBrowserTabActive=()=>{this.isRunning()||this.startTimer();for(const e of this.browserTabActiveCallbacks)e(this.getTimeInMilliseconds())},this.onBrowserActiveChange=()=>{"visible"===document.visibilityState?this.onBrowserTabActive():this.onBrowserTabInactive()},this.onTimePassed=()=>{for(const[e,{callback:t,pending:i,timeInMilliseconds:n}]of this.absoluteTimeEllapsedCallbacks.entries())i&&n<=this.getTimeInMilliseconds()&&(t(this.getTimeInMilliseconds()),this.absoluteTimeEllapsedCallbacks[e].pending=!1);for(const[e,{callback:t,timeInMilliseconds:i,multiplier:n}]of this.timeIntervalEllapsedCallbacks.entries())i<=this.getTimeInMilliseconds()&&(t(this.getTimeInMilliseconds()),this.timeIntervalEllapsedCallbacks[e].timeInMilliseconds=n(i));if(this.currentIdleTimeMs>=this.idleTimeoutMs&&this.isRunning()){this.idle=!0,this.stopTimer();for(const e of this.idleCallbacks)e(this.getTimeInMilliseconds())}else this.currentIdleTimeMs+=this.checkCallbacksIntervalMs},this.resetIdleTime=()=>{this.idle&&this.startTimer();for(const e of this.activeCallbacks)e(this.getTimeInMilliseconds());this.idle=!1,this.currentIdleTimeMs=0},this.registerEventListeners=()=>{const e={passive:!0},t=Object.assign(Object.assign({},e),{capture:!0});document.addEventListener("visibilitychange",this.onBrowserActiveChange);const i=Object(E.b)(this.resetIdleTime,2e3,{trailing:!1});for(const e of C)window.addEventListener(e,i,t);for(const t of I)document.addEventListener(t,i,e)},this.unregisterEventListeners=()=>{document.removeEventListener("visibilitychange",this.onBrowserActiveChange);for(const e of C)window.removeEventListener(e,this.resetIdleTime);for(const e of I)document.removeEventListener(e,this.resetIdleTime)},this.checkCallbacksOnInterval=()=>{this.checkCallbackIntervalId=window.setInterval(()=>{this.onTimePassed()},this.checkCallbacksIntervalMs)},this.running=!1,this.times=[],this.idle=!1,this.currentIdleTimeMs=0,this.marks={},this.measures={},this.stopTimerOnTabchange=s,this.browserTabActiveCallbacks=a,this.browserTabInactiveCallbacks=n,this.checkCallbacksIntervalMs=i,this.idleTimeoutMs=l,this.timeIntervalEllapsedCallbacks=e,this.absoluteTimeEllapsedCallbacks=t,this.idleCallbacks=r,this.activeCallbacks=o,this.registerEventListeners()}mark(e){this.marks[e]||(this.marks[e]=[]),this.marks[e].push({time:this.getTimeInMilliseconds()})}getMarks(e){if(0!==this.marks[e].length)return this.marks[e]}measure(e,t,i){const n=this.marks[t],r=n[n.length-1],s=this.marks[i],o=s[s.length-1];this.measures[e]||(this.measures[e]=[]),this.measures[e].push({duration:o.time-r.time,name:e,startTime:r.time})}getMeasures(e){if(this.measures[e]||0!==this.measures[e].length)return this.measures[e]}}var M=class{constructor(){this.timer=new S({}),this.start()}start(){this.timer.startTimer()}stop(){this.timer.stopTimer()}restart(){this.timer.destroy(),this.timer=new S({}),this.start()}isRunning(){return this.timer.isRunning()}getTimeInMilliseconds(){return this.timer.getTimeInMilliseconds()}callAtElapsedTime(e,t){this.timer.addAbsoluteTimeEllapsedCallback({callback:e,timeInMilliseconds:t,pending:!0})}callOnPageInactive(e){this.timer.addBrowserTabInactiveCallback(e)}setMarker(e){return this.timer.mark(e)}},x=i(6),j=i(1),N=i(11);class P{constructor(e){this.events=e,this.impressionStore=this.emptyImpressionStore(),this.logger=new s.a("local-impression-cache"),this.impressionObject=null,this.storage=Object(N.a)(),this.loadImpressions(),this.logger.info(`Finished initializing local impression cache with ${this.length()} records`)}getAndSetSessionNumber(){const e=Object(j.d)(j.a),t=e?Number.parseInt(e,10):Number.NaN;e&&this.logger.debug("Found session storage session number",e);const i=Number.isNaN(t)?1:t,n=this.impressionStore.sessionNumber;if(e&&i===n)return this.setSessionNumber(i),i;this.logger.debug("Session storage session number does not match impression store session number",n);const r=n+1;return this.setSessionNumber(r),r}setSessionNumber(e){this.logger.debug("Setting session storage session number",e),Object(j.f)(j.a,e.toString(),18e5),this.impressionStore.sessionNumber=e,this.writeStorage(),this.events.trigger(o.i.ImpressionCacheUpdate,{sessionNumber:e})}storeImpression(e,t){this.impressionObject=this.buildImpression(e,t),this.impressionObject&&(this.logger.debug("Adding new impression to local impression cache"),this.impressionStore.impressions.push(this.impressionObject),this.writeStorage(),this.events.trigger(o.i.ImpressionCacheUpdate,{impression:this.impressionObject}))}storeQuestionnaireImpression(e){const t=this.buildQuestionnaireImpression(e);t&&(this.logger.debug("Adding new questionnaire impression to local impression cache"),this.impressionStore.questionnaireImpressions.push(t),this.writeStorage(),this.events.trigger(o.i.ImpressionCacheUpdate,{questionnaireImpression:t}))}flushLocalCache(){this.logger.debug("Clearing local impression cache"),this.impressionStore=this.emptyImpressionStore(),this.storage.removeItem("_mutiny_impressions"),this.impressionObject=null}loadImpressions(){this.impressionStore=this.readStorage()}length(){return this.impressionStore.impressions.length+this.impressionStore.questionnaireImpressions.length}readStorage(){this.logger.debug("Loading local impression cache");const e=this.storage.getItem("_mutiny_impressions");return e?this.parseImpressionStore(e):this.emptyImpressionStore()}writeStorage(){this.logger.debug("Saving local impression cache"),this.storage.setItem("_mutiny_impressions",JSON.stringify(this.impressionStore))}buildImpression(e,t){if(e&&t.url){const i=t.query||{},[n]=t.url.split("?",2);return{query:i,token:e,url:n}}return null}buildQuestionnaireImpression(e){return null===this.impressionObject?null:e&&e.questionnaire&&e.questionnaire.key?Object.assign(Object.assign({},this.impressionObject),{questionnaire:{key:e.questionnaire.key}}):void 0}parseImpressionStore(e){try{const t=JSON.parse(e);return Array.isArray(t)?{impressions:this.parseRecords(t,this.parseImpression,"impression"),questionnaireImpressions:[],sessionNumber:1}:{impressions:this.parseRecords(t.impressions||[],this.parseImpression,"impression"),questionnaireImpressions:this.parseRecords(t.questionnaireImpressions||[],this.parseQuestionnaireImpression,"questionnaire impression"),sessionNumber:t.sessionNumber||1}}catch(e){return this.logger.info("Failed to parse local storage impression cache; discarding"),this.emptyImpressionStore()}}parseRecords(e,t,i){return this.logger.info(`Found ${e.length} impressions in local ${i} cache`),Object(x.e)(e.reduce((e,i)=>{const n=t(i);return n?e.push(n):this.logger.debug("Failed to parse local impression cache record with input "+i),e},[]),e=>e.token)}parseImpression(e){return e.token&&e.url?{query:e.query||{},token:e.token,url:e.url}:(g.b.notify("Tried to cache invalid impression value: "+e),null)}parseQuestionnaireImpression(e){if(!(e.token&&e.url&&e.questionnaire&&e.questionnaire.key))return g.b.notify("Tried to cache invalid questionnaire impression value: "+e),null;return{query:e.query||{},questionnaire:{key:e.questionnaire.key},token:e.token,url:e.url}}emptyImpressionStore(){return{impressions:[],questionnaireImpressions:[],sessionNumber:0}}}var z=i(41),A=i(10),q=i(4),D=i(20);const R="query."+v.b,L="query."+v.d,U="query."+v.c,B="client.mode";class H{constructor(e,t,i,l,c,f,v,b){var y,w;this.config=e,this.events=t,this.localImpressionStore=i,this.userDataStore=l,this.personalizedClientModes=c,this.hider=f,this.userDataHttpClient=v,this.clientDataMetadata=b,this.bugsnagClient=g.b,this.stateChangeHandler=new O,this.pageHideCallbacks=[],this.pageHideListener=void 0,this._isRedirecting=!1,this.logger=new s.a("context"),this.userDataStore=l,this.isNewUser=this.userDataStore.isNewUser(),this.visitorToken=this.userDataStore.getUserToken(),this.sessionToken=this.userDataStore.getSessionToken(),this.clientMode=this.userDataStore.getClientMode(),this.preview=this.computePreview(),this.highlightPersonalizations=this.computeHighlightPersonalizations(),this.trackingDisabled=Object(q.c)()||Boolean(this.preview),this.shouldRender=this.computeShouldRender(),this.userDataStore.set(B,this.clientMode,{localStorage:!1});const T=new M;this.timer=T,this.apiClient=new class{constructor(e,t,i,r,a,l,c){this.apiKey=e,this.localImpressionStore=i,this.visitorToken=r,this.preview=a,this.doNotTrack=l,this.logger=new s.a("api-client"),this.impressionToken=Object(n.a)(),t.on(o.i.StateChange,()=>{this.impressionToken=Object(n.a)(),this.logger.info("resetting impressionToken to",this.impressionToken)}),this.requestScheduler=this.initializeRequestScheduler(c)}identify(e,t={}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.Identify,{data:t,user_id:e})}segmentIdentify(e,t){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.SegmentIdentify,{anonymous_id:t,user_id:e})}trackPreview(){return this.doNotTrack?Promise.resolve():this.requestScheduler.track(h.Preview,{})}trackImpression(e,t){if(this.doNotTrack||Boolean(this.preview))return Promise.resolve();const i={device_type:Object(r.a)(),impression_token:this.impressionToken,metadata:Object.assign(Object.assign({},t),{client_version:"4.14.33",window_data:window.mutinyData}),referrer:document.referrer,session_token:e,url:window.location.href,user_agent:navigator.userAgent};return this.localImpressionStore.storeImpression(this.impressionToken,Object.assign(Object.assign({},i),{query:Object(a.i)(window.location.search)})),this.logger.info("Calling `trackImpression`",i),this.requestScheduler.track(h.Impression,i)}trackExperienceImpression({audienceSegment:e,campaignAccountId:t,experience:i,impressionType:n,selfOptimizingEventId:r}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.ExperienceImpression,{audience_segment_id:null==e?void 0:e.id,campaign_account_id:t,client_version:"4.14.33",dom_update_group_id:null==i?void 0:i.dom_update_group_id,impression_token:this.impressionToken,impression_type:n,self_optimizing_event_id:r})}trackConversion({conversionConfigurationId:e,formData:t}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.Conversion,{client_version:"4.14.33",conversion_configuration_id:e,form_data:t,impression_token:this.impressionToken,hostname:window.location.hostname})}trackQuestionnaireResponse({questionnaire:e,answers:t,formValues:i}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.QuestionnaireResponse,{answers:t,form_values:i,impression_token:this.impressionToken,questionnaire_id:e.id})}trackEvent({eventType:e,metadata:t}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.ImpressionEvent,{event_type:e,impression_token:this.impressionToken,metadata:t})}trackTime({timeInSeconds:e}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.ImpressionTime,{elapsed_time_in_ms:1e3*e,impression_token:this.impressionToken})}trackMetric(e,t){var{metricType:i,metricKey:n,previewMetric:r,tags:s}=e,o=u(e,["metricType","metricKey","previewMetric","tags"]);void 0===t&&(t=!1),this.logger.info("Calling `trackMetric`",i,n,s,o);const a=Boolean(this.preview)&&!r;return this.doNotTrack||a?Promise.resolve():(void 0===s&&(s={}),s.client_version="4.14.33",this.requestScheduler.track(h.Metric,Object.assign({metric_key:n,metric_type:i,tags:s},o),t))}trackVisitorIdentification({identificationType:e,value:t}){return this.doNotTrack||Boolean(this.preview)?Promise.resolve():this.requestScheduler.track(h.VisitorIdentification,{identification_type:e,value:t})}flush(e=!1){return this.requestScheduler.flush(e)}disableTracking(){this.doNotTrack=!0}initializeRequestScheduler(e){return this.logger.debug("Initializing batch request scheduler"),new d(this.apiKey,this.visitorToken,e)}}(this.config.api_key,this.events,this.localImpressionStore,this.visitorToken,this.preview,Object(q.c)(),T),this.exporter=new _.b(this.apiClient,this.visitorToken,this.sessionToken,this.userDataStore,this.config,this.trackingDisabled,this.preview,this.clientMode,this.clientDataMetadata),this.userDataClient=new m.b(this.userDataHttpClient,this.userDataStore,this.exporter,this.localImpressionStore,this.preview,this.hider),this.contentPlaylistClient=new p(this.config.api_key,this.config.company_token,this.visitorToken,this.sessionToken),this.shimQueue=null===(w=null===(y=window.mutiny)||void 0===y?void 0:y.client)||void 0===w?void 0:w._queue,this.publicInterface=new k.a(this.exporter,this.userDataStore),this.configureBugsnag(),this.exposePublicInterface(),this.flushShimQueue(),this.attachPageHideListener(),this.stateChangeHandler.attach(),T.start(),this.trackPreview()}isRedirecting(){return this._isRedirecting}shouldExitBeforeUserDataFetch(){if(this.preview)return!1;const e=this.isWhitelistedHost(),t=this.userDataStore.getClientMode()!==o.c.AssetViewer;return Object(q.d)()||t&&!e}shouldExitAfterUserDataFetch(){if(this.preview)return!1;const e=this.userDataStore.get(m.a),t=this.userDataStore.get("user.ip_address"),i=t&&this.config.blocked_ips.includes(t),n=this.isBlacklistedUrlParam();return this.isNewUser&&e||i||n}ensureShouldRender(e,t){return this.shouldRender?Promise.resolve(e()):(this.logger.debug("Mutiny rendering is disabled"+(t?"; "+t:"")),Promise.resolve())}onPageHide(e){this.pageHideCallbacks.push(e)}setRedirecting(e){this._isRedirecting=e}configureBugsnag(){Object(g.a)({mutinyClient:{companySlug:this.config.company_slug,iteration:this.config.client_iteration},visitor:{token:this.visitorToken}})}flushShimQueue(){const e=this.shimQueue;if(e)for(const t of Object.keys(e))for(const{args:i}of e[t]){const e=this.publicInterface[t];"function"==typeof e&&e.call(this.publicInterface,...i)}}exposePublicInterface(){Object(D.a)(),window.mutiny.client=this.publicInterface}trackPreview(){const e=Object(b.c)();if(!e)return;const t={experience_id:e.experience_id,variation_id:e.variation_id};e.exp<Date.now()/1e3?this.apiClient.trackMetric({metricKey:"client.unified_preview.visited.expired",metricType:o.p.Increment,previewMetric:!0,tags:t}):this.apiClient.trackMetric({metricKey:"client.unified_preview.visited",metricType:o.p.Increment,previewMetric:!0,tags:t})}computePreview(){const e=Object(b.c)(),t=this.userDataStore.get(R)||this.userDataStore.get(L);return e?o.v.Preview:this.config.preview?this.config.preview:t?o.v.Live:void 0}computeShouldRender(){return!!this.computePreview()||(this.clientMode===o.c.AssetViewer&&this.personalizedClientModes.includes(o.c.AssetViewer)||this.clientMode===o.c.Default)}computeHighlightPersonalizations(){const e=this.userDataStore.get(U);return!!this.preview&&"true"===e}isWhitelistedHost(){return!this.config.whitelisted_domains||(0===this.config.whitelisted_domains.length||this.config.whitelisted_domains.some(e=>Object(a.d)(window.location.host,e)))}isBlacklistedUrlParam(){return void 0!==this.config.blacklisted_query_params&&0!==Object.keys(this.config.blacklisted_query_params).length&&Object(A.d)(this.config.blacklisted_query_params).some(([e,t])=>{const i=this.userDataStore.get("query."+e);return i&&(0===t.length||t.includes(i))})}attachPageHideListener(){if(!this.pageHideListener){this.pageHideListener=()=>{for(const e of this.pageHideCallbacks)e()};const e="onpagehide"in self?"pagehide":"beforeunload";window.addEventListener(e,this.pageHideListener)}}}function F(e,t,i){const n=e.config,r=e.metadata,s=new T.a,a=new P(s),l=w(n,s,a),c=Object(z.c)(e),d=[o.c.Default,...c?[o.c.AssetViewer]:[]];return new H(n,s,a,l,d,t,i,r)}},56:function(e,t,i){"use strict";var n=i(9),r=i(2),s=i(47),o=i(0);const a=new r.a("reconcilliation-monitoring");let l=!1;var c=i(48),d=i(58);const u={characterData:!0,childList:!0,subtree:!0};t.a=class{constructor(e,t,i,n="update-renderer",s){this.personalize=e,this.domUpdates=t,this.domEvents=i,this.type=n,this.exporter=s,this.listeners=[],this.logger=new r.a(n)}get isUpdateRenderer(){return"update-renderer"===this.type}onRender(e){this.logger.info("attaching renderListener",e),this.listeners.push(e)}renderAsync(){return this.logger.info("renderAsync called, queuing requestAnimationFrame with",this.domUpdates),new Promise(e=>{requestAnimationFrame(()=>{this.logger.info("requestAnimationFrame executing"),this.render(),this.attachBodyObserver(),e(!0)})})}render(){return this.withErrorHandlingAndTracking(()=>{if(this.logger.info("Starting DOMRenderer render"),document.body&&this.personalize)for(const e of this.domUpdates)e.render();for(const e of this.domEvents)e.setup();for(const e of this.listeners)this.logger.info("Running render callbacks"),e();const e=this.domUpdates.filter(e=>e.isRendered()),t=this.domUpdates.filter(e=>!e.shouldRender()),i=this.domUpdates.filter(e=>e.shouldRender()&&!e.isRendered());return this.isUpdateRenderer&&document.dispatchEvent(new CustomEvent(o.i.DomRendererComplete,{detail:{renderedRecords:e.map(e=>e.record),unrenderedRecords:i.map(e=>e.record)}})),this.logger.info("Finished DOMRenderer render. Rendered elements: ",e),this.logger.info("Finished DOMRenderer render. Skipped elements: ",t),this.logger.info("Finished DOMRenderer render. Missing elements: ",i),e})}withErrorHandlingAndTracking(e){return Object(n.c)(()=>e())}teardown(){this.logger.info("Tearing down DOMRenderer"),this.observer&&this.observer.disconnect();for(const e of this.domUpdates)e.teardown();for(const e of this.domEvents)e.teardown()}attachBodyObserver(){this.logger.info("attaching MutationObserver to document",document),this.observer?this.observer.disconnect():this.observer=new d.a(e=>{const t=e.every(e=>Object(s.a)(e));if(!this.isUpdateRenderer||!t){this.logger.info("Mutation observed from DOMRenderer",e),Object(c.a)();const t=this.domUpdates.filter(e=>"modification"===e.record.personalization_type);for(const e of t)!e.isOriginalPresent()&&e.isRendered()&&e.teardown();for(const e of this.domEvents)!e.isOriginalRendered()&&e.isAttached()&&e.teardown();return this.render(),this.exporter&&function(e,t){var i;if(!l)for(const n of e)n.target instanceof HTMLElement&&["__next","___gatsby","root","__nuxt"].includes(n.target.id)&&0!==(null!==(i=n.removedNodes)&&void 0!==i?i:[]).length&&(Array.from(n.target.children).some(e=>!Object(s.b)(e))||(l=!0,a.error("Detected possible reconcilliation failure."),t.apiClient.trackMetric({metricKey:"client.monitor.application_fatal_unrender",metricType:o.p.Increment,tags:{client_version:"4.14.33"}})))}(e,this.exporter),!0}return this.logger.info("Ignoring mutations from Mutiny client",e),!1},{callbackLimit:200,logger:this.logger}),this.observer.observe(document,u)}isListening(){var e;return Boolean(null===(e=this.observer)||void 0===e?void 0:e.connected)}}},57:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return p}));var n=i(9),r=i(35),s=i(0),o=i(2),a=i(17),l=i(44),c=i(70),d=i.n(c);function u(...e){return d()(e.join("-"))()}const h=(e,t,i,a)=>{const l=new o.a("personalize");if(a)return n.b.leaveBreadcrumb("Personalized: 1"),l.info("Personalize: ",s.u.Personalized),l.info("Because of preview mode"),s.u.Personalized;if(i.get(r.e))return n.b.leaveBreadcrumb("Personalized: 5"),l.info("Personalize: ",s.u.Personalized),l.info("Because personalize store override is set"),s.u.Personalized;return function({holdOut:e,userData:t,audienceSegmentId:i,experienceId:n,strategy:o}){return o===s.a.PerSegment?e>u(t.getUserToken(),null!=i?i:""):o===s.a.PerExperience?e>u(t.getUserToken(),null!=n?n:""):e>t.get(r.f)}({holdOut:Number(e.hold_out),userData:i.getWriteableStore(),audienceSegmentId:t.id,experienceId:e.id,strategy:e.experiment_assignment_grouping_strategy})?(n.b.leaveBreadcrumb("Personalized: 6"),l.info("Personalize: ",s.u.Personalized),l.info("Because there are DOM Updates to show, and user is greater than hold out percentage"),s.u.Personalized):(n.b.leaveBreadcrumb("Personalized: 7"),l.info("Personalize: ",s.u.Control),l.info("Because there are DOM Updates to show, and user is lower than hold out percentage"),s.u.Control)};function p(e){const t=e=>{if(!e)return[];if("string"==typeof e){const t=[],i=new RegExp(a.a);let n=i.exec(e);return Object(l.c)(()=>!!n,()=>{t.push(n[1]),n=i.exec(e)}),t}return"object"==typeof e?Object.values(e).flatMap(e=>t(e)):[]};return new Set(t(e))}},58:function(e,t,i){"use strict";var n=i(33),r=i(0);t.a=class{constructor(e,t){this.callback=e,this.connected=!1,this.callbackCount=0,this.firstCallbackAt=void 0,this.observer=new MutationObserver(this.wrappedCallback.bind(this)),this.callbackLimit=void 0===(null==t?void 0:t.callbackLimit)?100:t.callbackLimit,this.exporter=null==t?void 0:t.exporter,this.domUpdateId=null==t?void 0:t.domUpdateId,this.logger=null==t?void 0:t.logger}observe(e,t){var i;this.connected=!0,null===(i=this.logger)||void 0===i||i.info("Observing mutations on new node",e),this.observer.observe(e,t||{})}disconnect(){var e;this.connected=!1,null===(e=this.logger)||void 0===e||e.info("Unsubscribing mutation observer from new changes"),this.observer.disconnect()}takeRecords(){return this.observer.takeRecords()}wrappedCallback(e){var t,i,s;if(this.connected)return(void 0===this.firstCallbackAt||performance.now()-this.firstCallbackAt>=1e3)&&(this.firstCallbackAt=performance.now(),this.callbackCount=0),this.callback(e,this.observer)&&(this.callbackCount+=1,null===(i=this.logger)||void 0===i||i.debug("Executed WrappedMutationObserver callback",{callbackCount:this.callbackCount,callbackLimit:this.callbackLimit})),this.shouldDisconnect()?(this.disconnect(),void(null===(s=this.exporter)||void 0===s||s.track(n.a.Metric,{description:this.domUpdateId?"DOM Update ID: "+this.domUpdateId:"No DOM Update ID provided",metricKey:"Client DOM Update MutationObserver Limit Exceeded",metricType:r.p.Event}))):void 0;null===(t=this.logger)||void 0===t||t.error("Mutation observer callback triggered while not connected")}shouldDisconnect(){var e;return!!(this.callbackCount>=this.callbackLimit&&this.firstCallbackAt&&performance.now()-this.firstCallbackAt<1e3)&&(null===(e=this.logger)||void 0===e||e.warn("Disconnecting WrappedMutationObserver because exceeded per second callback limit",{callbackCount:this.callbackCount,callbackLimit:this.callbackLimit}),!0)}}},59:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));i(49);var n=i(9),r=i(33),s=i(2),o=i(0),a=i(8);const l="user_data_failed";class c{constructor(e,t,i,n,r,o){this.httpClient=e,this.userDataStore=t,this.exporter=i,this.localImpressionStore=n,this.preview=r,this.hider=o,this.syncLogger=new s.a("user-data-client-sync"),this.asyncLogger=new s.a("user-data-client-async")}updateUserDataStore(e){if(this.preview!==o.v.Preview||Object(a.b)())this.userDataStore.setBulk(e);else{const t=this.userDataStore.getData();this.userDataStore.setBulk(Object.assign(Object.assign({},e),t))}}getAsyncUserData(){return this.fetchUserData(this.asyncLogger,!0).then(e=>e.json).then(e=>(this.updateUserDataStore(e),e))}getUserData(){return this.fetchUserData(this.syncLogger,!1).then(e=>{const t=e.headers.get("x-cache"),i=null==t?void 0:t.includes("MISS");return e.ok?(i?(this.localImpressionStore.flushLocalCache(),this.localImpressionStore.setSessionNumber(this.getSessionNumber(e.json)||1)):this.getSessionNumber(e.json)&&delete e.json.person.behavior.session_number,e.json):{[l]:!0}}).then(Object(n.d)(e=>(this.updateUserDataStore(e),(this.preview===o.v.Editor||this.preview===o.v.Preview)&&window.__mutiny&&window.__mutiny.preview_data&&this.userDataStore.setBulk(window.__mutiny.preview_data),e))).catch(e=>{throw this.hider.removeHider(!1,"user data request failed"),this.userDataStore.set(l,"true"),e})}fetchUserData(e,t){e.info("Fetching user data");const i=performance.now(),s=`[Mutiny-${t?"async":"sync"}]`;return n.b.leaveBreadcrumb(s+" Loading user-data"),this.httpClient.fetch(t).then(Object(n.d)(a=>{t||this.checkForTimeout(e);const l=a.headers.get("x-cache"),c=(null==l?void 0:l.includes("MISS"))?"miss":"hit",d=a.headers.get("x-continent-code"),u=a.headers.get("x-country-code"),h={cdn_client_connection_speed:a.headers.get("x-connection-speed")||"UNKNOWN",cdn_client_continent:d||"UNKNOWN",cdn_client_country_code:u||"UNKNOWN",cdn_edge_data_center:a.headers.get("x-edge-datacenter")||"UNKNOWN",cdn_edge_region:a.headers.get("x-edge-region")||"UNKNOWN"},p=Object.assign({async:t.toString(),cdn_status:c,status:a.status.toString()},h);this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch",metricType:o.p.Increment,tags:p}),this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch.time",metricType:o.p.Timing,tags:p,value:performance.now()-i});const m=performance.getEntriesByType&&performance.getEntriesByType("resource").find(e=>e.name.startsWith("https://client-registry.mutinycdn.com"));return m&&this.exporter.track(r.a.Metric,{metricKey:"client.bundle.fetch.time",metricType:o.p.Timing,tags:h,value:m.duration}),a.ok?(e.info("User data loaded successfully"),n.b.leaveBreadcrumb(s+" User data loaded"),this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch.success",metricType:o.p.Increment,tags:p}),a):(e.info("User data failed"),n.b.leaveBreadcrumb(`${s} User data fail ${a.status}`),this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch.failure",metricType:o.p.Increment,tags:p}),a)})).catch(i=>{throw e.info("Fetch failure",i),this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch.network_error",metricType:o.p.Increment,tags:{async:t.toString()}}),i})}getSessionNumber(e){if(e.person&&e.person.behavior&&void 0!==e.person.behavior.session_number)return e.person.behavior.session_number}checkForTimeout(e){document.documentElement.dataset.mutinyLoaded&&(this.exporter.track(r.a.Metric,{metricKey:"client.user_data.fetch.timed_out",metricType:o.p.Increment}),e.info("Load timed out before user data finished"))}}},60:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i(4);class r{constructor(){this.data={}}getItem(e){return this.data.hasOwnProperty(e)?this.data[e]:null}setItem(e,t){this.data[e]=t}}let s;function o(){return s||(s=!Object(n.d)()&&function(){try{return sessionStorage.setItem("test","test"),"test"!==sessionStorage.getItem("test")?!1:(sessionStorage.removeItem("test"),!0)}catch(e){return!1}}()?sessionStorage:new r,s)}},61:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return a}));var n=i(0),r=i(4),s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};function o(e){document.dispatchEvent(new CustomEvent(n.i.ExperienceRenderComplete,{detail:{experience:e}}))}class a{constructor(e,t){this.exporter=e,this.userDataStore=t,this._renderedRecords=[],this._unrenderedRecords=[],this._experiences=[],document.addEventListener(n.i.DomRendererComplete,({detail:e})=>{e.renderedRecords&&(this._renderedRecords=e.renderedRecords),e.unrenderedRecords&&(this._unrenderedRecords=e.unrenderedRecords)}),document.addEventListener(n.i.ExperienceRenderComplete,({detail:e})=>{e.experience&&this._experiences.push(e.experience)}),document.addEventListener(n.i.StateChange,()=>{this._experiences=[],this._renderedRecords=[],this._unrenderedRecords=[]})}get experiences(){return this._experiences}get renderedRecords(){return this._renderedRecords}get unrenderedRecords(){return this._unrenderedRecords}identify(e,t={}){return this.exporter.apiClient.identify(e,t)}trackConversion(e){return this.exporter.apiClient.trackConversion({formData:e})}defaultOptOut(){return Object(r.b)()}optOut(){return this.exporter.disableTracking(),Object(r.f)()}optIn(){return Object(r.e)()}getRenderedRecords(){return this._renderedRecords}getUnrenderedRecords(){return this._unrenderedRecords}getUserData(){const e=this.userDataStore.toJSON(),{user:t}=e;return s(e,["user"])}getCampaignData(){const e=this.getUserData(),t=this._experiences.filter(e=>Boolean(e.audienceSegment.campaign_slug));return 0===t.length?{}:Object.assign({},e[t[0].audienceSegment.campaign_slug])}getRenderedExperiences(){return this._experiences}}},62:function(e,t,i){"use strict";i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return h})),i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return b}));var n=i(9),r=i(14),s=i(0),o=i(6),a=i(10),l=i(17),c=i(3),d=i(18);const u=e=>"boolean_join"in e&&"clauses"in e,h=e=>"attribute"in e&&"value"in e&&"comparator"in e;function p(e,t,i){switch(i){case s.e.Equal:return e===t;case s.e.NotEqual:return e!==t;case s.e.NotIncludes:return!e||!e.includes(t);case s.e.UrlNotEqual:return!e||"string"!=typeof t||!Object(c.k)(t,e);case s.e.UrlHostNotEqual:return!e||"string"!=typeof t||!Object(c.d)(e,t);case s.e.UrlPathNotEqual:return!e||"string"!=typeof t||!Object(c.e)(e,t);default:if(null==e||null===t)return!1;switch(i){case s.e.UrlEqual:return"string"==typeof t&&Object(c.k)(t,e);case s.e.GreaterThan:return e>t;case s.e.GreaterThanOrEqual:return e>=t;case s.e.LessThan:return e<t;case s.e.LessThanOrEqual:return e<=t;case s.e.Includes:return null==e?void 0:e.includes(t);case s.e.StartsWith:return null==e?void 0:e.startsWith(t);case s.e.EndsWith:return null==e?void 0:e.endsWith(t);case s.e.MatchesRegex:return e&&"string"==typeof t&&Boolean(new RegExp(t).test(e));case s.e.UrlHostEqual:return e&&"string"==typeof t&&Object(c.d)(e,t);case s.e.UrlPathEqual:return e&&"string"==typeof t&&Object(c.e)(e,t)}}}function m(e,t){if(u(e)){if("and"===e.boolean_join)return Object(o.a)(e.clauses,e=>m(e,t));if("or"===e.boolean_join)return Object(o.b)(e.clauses,e=>m(e,t))}else if(h(e))return t(e);return n.b.notify("Malformed condition has a node that is neither a leaf or inner node",{metaData:{conditionNode:JSON.stringify(e)}}),!1}function g(e,t,i,r){return r?m(r,({attribute:t,value:r,comparator:o})=>p(function(e,t){switch(t){case s.d.Count:return e.length;default:return n.b.notify("Unrecognized aggregation attribute",{metaData:{aggregationKey:t}}),null}}(e.filter(i),t),r,o)):t(e,i)}function f(e,t,i,n,l,c,d){const u=(c?function(e,t,i){return e.filter(e=>i(t,new r.a(e)))}(e,c.root_node,l):e).map(e=>Object(a.c)(e,t)),h=e=>p(e,i,n);switch(n){case s.e.Equal:case s.e.UrlEqual:return null==i&&0===u.length||g(u,o.b,h,null==d?void 0:d.root_node);case s.e.GreaterThan:case s.e.GreaterThanOrEqual:case s.e.LessThan:case s.e.LessThanOrEqual:return g(u,o.b,h,null==d?void 0:d.root_node);case s.e.NotEqual:case s.e.UrlNotEqual:return(null!=i||0!==u.length)&&g(u,o.a,h,null==d?void 0:d.root_node);case s.e.Includes:return u.length>0&&g(u,o.b,h,null==d?void 0:d.root_node);case s.e.NotIncludes:return 0===u.length||g(u,o.a,h,null==d?void 0:d.root_node);default:return!1}}function v(e,t){return void 0===e||m(e,e=>function(e,t,i){const r=e.attribute.includes("query.")&&e.value?Object(c.j)(e.value):e.value,{topLevelPath:s,nestedPath:o}=Object(l.e)(e.attribute);let a=t.get(s);return o?(a=a||[],Array.isArray(a)?f(a,o,r,e.comparator,i,e.filter,e.aggregation):(n.b.notify("Invalid array condition on ",{metaData:{accessedData:a}}),!1)):p(a,r,e.comparator)}(e,t,v))}function b(e,t){return e.condition_tree?v(e.condition_tree.root_node,t):Object(d.b)(e.condition,t)}},63:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i(18),r=i(57),s=i(48),o=i(17),a=i(2),l=i(0),c=i(5),d=i(39),u=i(46),h=i(68),p=i(64);class m{constructor(e,t,i,n,r){this.record=e,this.userData=t,this.exporter=i,this.preview=n,this.onCustomJsExecuted=r,this.logger=new a.a("dom-update")}isRendered(){var e,t;return null!==(t=null===(e=this.personalization)||void 0===e?void 0:e.isRendered())&&void 0!==t&&t}isOriginalPresent(){var e;return!!(null===(e=this.personalization)||void 0===e?void 0:e.originalElement)&&document.contains(this.personalization.originalElement)}shouldRender(){const e=this.preview===l.v.Editor,t=Array.from(Object(r.b)(this.record)),i=t.every(e=>null!==this.userData.get(e));return i||this.logger.warn("Found invalid content dependencies.",t.filter(e=>null===this.userData.get(e))),(e||i)&&Object(n.b)(this.record.condition,this.userData)}render(){var e,t,i,n,r,s,o,a,m,g,f,v,b;if(this.isRendered()||!this.shouldRender())return;null===(e=this.personalization)||void 0===e||e.teardown();const y=this.getElement();if(!y)return;if(!(y instanceof HTMLElement))return this.logger.warn("Attempted to personalize a non-HTMLElement. Skipping rendering."),void(null===(t=this.exporter)||void 0===t||t.apiClient.trackMetric({description:`Personalization illegally targets a non-HTMLElement (${this.record.resource_id})`,metricKey:"client.rendering.invalid_personalization_target",metricType:l.p.Event}));if("modification"===this.record.personalization_type&&(null===(i=d.a.getPersonalizationForElement(y))||void 0===i?void 0:i.isRendered()))return this.logger.warn("Skipping rendering of 'modification' personalization targetting an already personalized element."),void(null===(n=this.exporter)||void 0===n||n.apiClient.trackMetric({description:`Personalization targetted element already personalized by another personalization (${this.record.resource_id})`,metricKey:"Duplicate target within personalization detected",metricType:l.p.Event}));const w="addition"===this.record.personalization_type;if(w&&(null===(r=d.a.getAdditionForElement(this.record.resource_id))||void 0===r?void 0:r.isRendered()))return this.logger.warn("Skipping rendering of 'addition' personalization targetting an already personalized element."),void(null===(s=this.exporter)||void 0===s||s.apiClient.trackMetric({description:`Personalization targetted element already personalized by another personalization (${this.record.resource_id})`,metricKey:"Duplicate target within personalization detected",metricType:l.p.Event}));if(w){if(!this.record.data.tag)return this.logger.error("Skipping rendering of 'addition' personalization because it has no tag."),void(null===(o=this.exporter)||void 0===o||o.apiClient.trackMetric({description:`Addition personalization has no tag and cannot render (${this.record.resource_id})`,metricKey:"Addition personalization has no tag",metricType:l.p.Event}));if(!this.record.data.position)return this.logger.error("Skipping rendering of 'addition' personalization because it has no position."),void(null===(a=this.exporter)||void 0===a||a.apiClient.trackMetric({description:`Addition personalization has no position and cannot render (${this.record.resource_id})`,metricKey:"Addition personalization has no position",metricType:l.p.Event}))}const k=w?Object(u.b)(this.record.data.tag):Object(u.c)(y);if(!k)return;if(Object(h.d)(y)){const e=h.b[this.record.selector];if(e)for(const t of Object.keys(h.a))y.style.setProperty(t,null!==(m=e.originalStyles[t])&&void 0!==m?m:"")}for(const e of Array.from(null!==(f=null===(g=y.parentElement)||void 0===g?void 0:g.querySelectorAll(":scope > "+k))&&void 0!==f?f:[]))e.remove();for(const e of Array.from(null!==(b=null===(v=y.parentElement)||void 0===v?void 0:v.querySelectorAll(`:scope > [data-mutiny-id="${this.record.resource_id}"]`))&&void 0!==b?b:[]))e.remove();let _;if(this.personalization=Object(c.a)(w?this.record.data.tag:y.tagName.toLowerCase(),{is:k}),this.personalization.dataset.mutinyRoot="true",this.personalization.dataset.mutinyId=this.record.resource_id,this.personalization.dataset.mutinyAddition=String(w),!this.record.data.position||(_=this.getElement(this.record.data.position.parent_selector)||void 0,_)){this.personalization.initializePersonalization(w?void 0:y,this.record,this.userData,_,this.exporter,this.onCustomJsExecuted),this.personalization.placePersonalization();for(const e of p.a)for(const t of Array.from(e.targets.values()))t instanceof HTMLElement&&d.a.getContainingPersonalizationForElement(t)===this.personalization&&(e.unobserve(t,!0),e.observe(t))}}teardown(){var e;null===(e=this.personalization)||void 0===e||e.teardown()}getElement(e=this.record.selector){var t;return null!==(t=Array.from(Object(s.c)(e,this.record.selectorMode)).find(e=>!this.record.content_hash||Number(this.record.content_hash)===Object(o.b)(e.innerHTML)))&&void 0!==t?t:null}}},64:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(39);const r=globalThis.IntersectionObserver,s=[];class o extends r{constructor(e,t){super(o.wrappedCallback(e),t),this.targets=new Set,s.push(this)}observe(e){if(!(e instanceof HTMLElement))return this.targets.add(e),super.observe(e);const t=n.a.getClonedElement(e);return this.targets.add(null!=t?t:e),super.observe(null!=t?t:e)}unobserve(e,t=!1){if(!(e instanceof HTMLElement)||t)return this.targets.delete(e),super.unobserve(e);const i=n.a.getClonedElement(e);return this.targets.delete(null!=i?i:e),super.unobserve(null!=i?i:e)}static wrappedCallback(e){return(t,i)=>{const r=t.map(e=>{if(!(e.target instanceof HTMLElement))return e;const t=n.a.getOriginalElement(e.target);return t?Object.assign(Object.assign({},this.copyIntersectionObserverEntry(e)),{target:t}):e});e(r,i)}}static copyIntersectionObserverEntry(e){const t=Object.getOwnPropertyNames(Object.getPrototypeOf(e)).filter(e=>"constructor"!==e),i={};for(const n of t){const t=n;i[t]=e[t]}return i}}globalThis.IntersectionObserver=o},68:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"d",(function(){return a}));var n=i(39);const r=Element.prototype.getBoundingClientRect;Element.prototype.getBoundingClientRect=function(){const e=n.a.getClonedElement(this);return r.call(null!=e?e:this)};const s={display:"none"},o={};t.c=class{constructor(e,t){this.originalStyles={},this.hidden=!1,this.element=e,t&&(o[t]=this),this.hide(),this.mutationObserver=new MutationObserver(()=>{this.forEachReservedStyle(t=>{e.style[t]!==s[t]&&this.hidden&&(this.originalStyles[t]=e.style[t],this.element.style.setProperty(t,s[t],"important"))})}),this.mutationObserver.observe(e,{attributes:!0,attributeFilter:["style"]})}hide(){this.hidden=!0,this.forEachReservedStyle(e=>{this.originalStyles[e]=this.element.style[e],this.element.style.setProperty(e,s[e],"important")})}show(){this.hidden=!1,this.forEachReservedStyle(e=>{var t;return this.element.style.setProperty(e,null!==(t=this.originalStyles[e])&&void 0!==t?t:"")})}forEachReservedStyle(e){for(const t of Object.keys(s))e(t)}};const a=e=>Object.entries(s).every(([t,i])=>e.style[t]===i)},69:function(e,t,i){"use strict";i.r(t),i.d(t,"wrapEditorDomUpdates",(function(){return h})),i.d(t,"attachEditorInterface",(function(){return p}));var n=i(56),r=i(63),s=i(35),o=i(43),a=i(46),l=i(39),c=i(48),d=i(0),u=i(5);function h(e,t={},i){return e.map(e=>new r.a(e,new s.g(t,new o.a),void 0,d.v.Editor,i))}function p(){window.mutinyEditor||(window.mutinyEditor={DOMRenderer:n.a,isMutinyElement:a.d,getAllOriginalChildren:a.a,loadQuestionnaireInterface:()=>Promise.all([i.e(0),i.e(1),i.e(10)]).then(i.bind(null,52)).then(({default:e})=>i.e(4).then(i.bind(null,30)).then(({render:t,h:n})=>{let r=document.querySelector("#mutiny-preact");return r||(r=Object(u.a)("div"),r.setAttribute("id","mutiny-preact"),document.body.append(r)),t(n(e,{}),r),Promise.all([i.e(0),i.e(1),i.e(7)]).then(i.bind(null,88))})),personalizationRegistry:l.a,querySelector:c.b,querySelectorAll:c.c,wrapDomUpdates:h})}p()},78:function(e,t){}}]);